name: "ğŸ”¬ Clean Eating Scraper â€” Kupi.cz"

on:
  schedule:
    - cron: "0 5 * * 1"
    - cron: "0 5 * * 3"
    - cron: "0 5 * * 4"
  workflow_dispatch:

permissions:
  contents: write

jobs:
  scrape:
    runs-on: ubuntu-latest
    steps:
      - name: "ğŸ“¥ Checkout repozitÃ¡r"
        uses: actions/checkout@v4

      - name: "ğŸ Setup Python"
        uses: actions/setup-python@v5
        with:
          python-version: "3.12"

      - name: "ğŸ“¦ InÅ¡talÃ¡cia zÃ¡vislostÃ­"
        run: pip install -r clean-eating-app/requirements.txt

      - name: "ğŸ”¬ Spustenie scrapera"
        run: python clean-eating-app/scraper/kupi_scraper.py --output clean-eating-app/data

      - name: "ğŸ“Š Kontrola vÃ½sledkov"
        run: |
          echo "=== VÃ½sledky scrapu ==="
          cat clean-eating-app/data/summary.json | python -m json.tool
          echo ""
          echo "PoÄet produktov:"
          cat clean-eating-app/data/products.json | python -c "import sys,json; d=json.load(sys.stdin); print(f'  Celkom: {d[\"total_products\"]}')"

      - name: "ğŸ’¾ Commit a push novÃ½ch dÃ¡t"
        run: |
          git config user.name "Clean Eating Bot"
          git config user.email "bot@clean-eating.app"
          git add clean-eating-app/data/
          
          if git diff --staged --quiet; then
            echo "Å½iadne novÃ© dÃ¡ta â€” skip"
          else
            DATUM=$(date +%Y-%m-%d)
            git commit -m "ğŸ”„ AktualizÃ¡cia letÃ¡kov $DATUM"
            git push
          fi
