<!DOCTYPE html>
<html lang="sk">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover, user-scalable=no">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="theme-color" content="#0a0f1a">
<title>Clean Eating Agent ‚Äî P≈ô√≠bram</title>
<link rel="manifest" href="manifest.json">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=DM+Sans:ital,wght@0,400;0,500;0,700&family=JetBrains+Mono:wght@500&display=swap" rel="stylesheet">
<style>
:root {
  --bg: #0a0f1a;
  --bg2: #111827;
  --bg3: #1a2236;
  --surface: #1e2a3e;
  --border: #2a3654;
  --text: #e8ecf4;
  --text2: #8b97b0;
  --accent: #22d3ee;
  --accent2: #06b6d4;
  --green: #34d399;
  --yellow: #fbbf24;
  --red: #f87171;
  --orange: #fb923c;
  --purple: #a78bfa;
  --lidl: #0050aa;
  --kaufland: #e10915;
  --penny: #cd1719;
  --billa: #f5e100;
  --albert: #e2001a;
  --safe-top: env(safe-area-inset-top, 0px);
  --safe-bottom: env(safe-area-inset-bottom, 0px);
}

* { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
html { font-family: 'DM Sans', -apple-system, sans-serif; background: var(--bg); color: var(--text); }
body { min-height: 100dvh; padding-top: var(--safe-top); padding-bottom: calc(72px + var(--safe-bottom)); overflow-x: hidden; }

/* ===== HEADER ===== */
.header {
  position: sticky; top: 0; z-index: 100;
  background: rgba(10,15,26,0.85); backdrop-filter: blur(20px) saturate(180%);
  -webkit-backdrop-filter: blur(20px) saturate(180%);
  padding: calc(var(--safe-top) + 12px) 20px 12px;
  border-bottom: 1px solid var(--border);
}
.header-top { display: flex; align-items: center; justify-content: space-between; margin-bottom: 8px; }
.logo { display: flex; align-items: center; gap: 10px; }
.logo-icon { width: 36px; height: 36px; background: linear-gradient(135deg, var(--accent), var(--green)); border-radius: 10px; display: flex; align-items: center; justify-content: center; font-size: 18px; }
.logo-text { font-size: 17px; font-weight: 700; letter-spacing: -0.3px; }
.logo-sub { font-size: 11px; color: var(--text2); font-weight: 500; }
.header-badge { font-family: 'JetBrains Mono', monospace; font-size: 10px; background: rgba(34,211,238,0.15); color: var(--accent); padding: 4px 10px; border-radius: 20px; border: 1px solid rgba(34,211,238,0.3); }
.week-info { font-size: 12px; color: var(--text2); display: flex; align-items: center; gap: 6px; }
.week-dot { width: 6px; height: 6px; background: var(--green); border-radius: 50%; animation: pulse 2s infinite; }
@keyframes pulse { 0%,100% { opacity:1 } 50% { opacity:0.4 } }

/* ===== CATEGORIES NAV ===== */
.cat-nav { display: flex; gap: 8px; padding: 16px 20px 8px; overflow-x: auto; scrollbar-width: none; -webkit-overflow-scrolling: touch; }
.cat-nav::-webkit-scrollbar { display: none; }
.cat-btn {
  flex-shrink: 0; padding: 10px 18px; border-radius: 24px; border: 1px solid var(--border);
  background: var(--bg2); color: var(--text2); font-size: 13px; font-weight: 600; cursor: pointer;
  display: flex; align-items: center; gap: 6px; transition: all 0.2s;
  font-family: inherit;
}
.cat-btn.active { background: var(--accent); color: var(--bg); border-color: var(--accent); }
.cat-btn .count { font-family: 'JetBrains Mono', monospace; font-size: 11px; opacity: 0.7; }

/* ===== STATS BAR ===== */
.stats-bar {
  display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; padding: 12px 20px;
}
.stat-card {
  background: var(--bg2); border: 1px solid var(--border); border-radius: 14px; padding: 12px; text-align: center;
}
.stat-val { font-family: 'JetBrains Mono', monospace; font-size: 20px; font-weight: 700; color: var(--accent); }
.stat-label { font-size: 10px; color: var(--text2); margin-top: 2px; text-transform: uppercase; letter-spacing: 0.5px; }

/* ===== PRODUCT CARDS ===== */
.products { padding: 8px 20px; display: flex; flex-direction: column; gap: 12px; }
.product-card {
  background: var(--bg2); border: 1px solid var(--border); border-radius: 16px;
  overflow: hidden; transition: transform 0.2s, box-shadow 0.2s;
}
.product-card:active { transform: scale(0.98); }

.product-main { padding: 16px; display: flex; gap: 14px; align-items: flex-start; }

.score-ring {
  width: 52px; height: 52px; flex-shrink: 0; position: relative;
}
.score-ring svg { transform: rotate(-90deg); }
.score-ring circle { fill: none; stroke-width: 4; }
.score-ring .track { stroke: var(--bg3); }
.score-ring .fill { stroke-linecap: round; transition: stroke-dashoffset 0.8s ease; }
.score-val {
  position: absolute; inset: 0; display: flex; align-items: center; justify-content: center;
  font-family: 'JetBrains Mono', monospace; font-size: 14px; font-weight: 700;
}

.product-info { flex: 1; min-width: 0; }
.product-name { font-size: 15px; font-weight: 700; line-height: 1.3; margin-bottom: 4px; }
.product-meta { font-size: 12px; color: var(--text2); margin-bottom: 8px; }

.price-row { display: flex; align-items: baseline; gap: 8px; flex-wrap: wrap; }
.price-sale { font-family: 'JetBrains Mono', monospace; font-size: 20px; font-weight: 700; color: var(--green); }
.price-unit { font-size: 11px; color: var(--text2); }
.price-original { font-size: 12px; color: var(--text2); text-decoration: line-through; }
.price-discount {
  font-family: 'JetBrains Mono', monospace; font-size: 11px; font-weight: 600;
  background: rgba(251,191,36,0.15); color: var(--yellow); padding: 2px 8px; border-radius: 10px;
}

.store-badges { display: flex; gap: 6px; margin-top: 10px; flex-wrap: wrap; }
.store-badge {
  font-size: 11px; font-weight: 600; padding: 4px 10px; border-radius: 8px;
  display: flex; align-items: center; gap: 4px;
}
.store-badge.lidl { background: rgba(0,80,170,0.2); color: #4da3ff; border: 1px solid rgba(0,80,170,0.3); }
.store-badge.kaufland { background: rgba(225,9,21,0.15); color: #ff6b6b; border: 1px solid rgba(225,9,21,0.25); }
.store-badge.penny { background: rgba(205,23,25,0.15); color: #ff8080; border: 1px solid rgba(205,23,25,0.25); }
.store-badge.billa { background: rgba(245,225,0,0.15); color: #f5e100; border: 1px solid rgba(245,225,0,0.25); }
.store-badge.albert { background: rgba(226,0,26,0.15); color: #ff7070; border: 1px solid rgba(226,0,26,0.25); }
.store-badge.tesco { background: rgba(0,87,184,0.15); color: #5bacff; border: 1px solid rgba(0,87,184,0.25); }

.store-badge .badge-price { font-family: 'JetBrains Mono', monospace; }

/* ===== BIO AUDIT EXPANDABLE ===== */
.bio-toggle {
  display: flex; align-items: center; justify-content: space-between;
  padding: 10px 16px; border-top: 1px solid var(--border); cursor: pointer;
  font-size: 12px; color: var(--accent); font-weight: 600;
}
.bio-toggle .arrow { transition: transform 0.3s; font-size: 14px; }
.bio-toggle.open .arrow { transform: rotate(180deg); }

.bio-panel {
  max-height: 0; overflow: hidden; transition: max-height 0.4s ease;
  background: rgba(34,211,238,0.03);
}
.bio-panel.open { max-height: 500px; }
.bio-content { padding: 12px 16px; display: flex; flex-direction: column; gap: 10px; }

.bio-item { display: flex; gap: 10px; align-items: flex-start; }
.bio-icon { font-size: 16px; flex-shrink: 0; width: 24px; text-align: center; margin-top: 1px; }
.bio-label { font-size: 11px; font-weight: 700; text-transform: uppercase; letter-spacing: 0.5px; color: var(--text2); margin-bottom: 2px; }
.bio-score-bar { height: 4px; border-radius: 2px; background: var(--bg3); margin: 4px 0; }
.bio-score-fill { height: 100%; border-radius: 2px; transition: width 0.6s ease; }
.bio-detail { font-size: 11px; color: var(--text2); line-height: 1.5; }

/* ===== VALIDITY TAG ===== */
.validity { font-size: 10px; color: var(--text2); margin-top: 6px; display: flex; align-items: center; gap: 4px; }
.validity.ending { color: var(--orange); }
.validity.active { color: var(--green); }

/* ===== BOTTOM NAV ===== */
.bottom-nav {
  position: fixed; bottom: 0; left: 0; right: 0; z-index: 100;
  background: rgba(10,15,26,0.92); backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border-top: 1px solid var(--border);
  display: flex; padding: 8px 20px calc(8px + var(--safe-bottom));
}
.nav-item {
  flex: 1; display: flex; flex-direction: column; align-items: center; gap: 4px;
  padding: 6px; border-radius: 12px; cursor: pointer; transition: all 0.2s;
  background: none; border: none; color: var(--text2); font-family: inherit;
}
.nav-item.active { color: var(--accent); }
.nav-icon { font-size: 20px; }
.nav-label { font-size: 10px; font-weight: 600; }

/* ===== LOADING ===== */
.loading { text-align: center; padding: 60px 20px; }
.loading-spinner {
  width: 40px; height: 40px; border: 3px solid var(--border); border-top-color: var(--accent);
  border-radius: 50%; animation: spin 0.8s linear infinite; margin: 0 auto 16px;
}
@keyframes spin { to { transform: rotate(360deg) } }

/* ===== EMPTY STATE ===== */
.empty { text-align: center; padding: 40px 20px; color: var(--text2); }
.empty-icon { font-size: 48px; margin-bottom: 12px; }
.empty-title { font-size: 16px; font-weight: 700; color: var(--text); margin-bottom: 4px; }

/* ===== SOURCE LINK ===== */
.source-link {
  display: inline-flex; align-items: center; gap: 4px;
  font-size: 10px; color: var(--text2); text-decoration: none; margin-top: 6px;
  opacity: 0.6; transition: opacity 0.2s;
}
.source-link:hover { opacity: 1; }

/* ===== FOOTER ===== */
.footer { text-align: center; padding: 24px 20px 12px; font-size: 11px; color: var(--text2); opacity: 0.5; }

/* ===== ANIMATIONS ===== */
.fade-in { animation: fadeIn 0.4s ease; }
@keyframes fadeIn { from { opacity:0; transform:translateY(8px) } to { opacity:1; transform:translateY(0) } }
.card-enter { animation: cardEnter 0.3s ease backwards; }
@keyframes cardEnter { from { opacity:0; transform:translateY(16px) } }
</style>
</head>
<body>

<div class="header">
  <div class="header-top">
    <div class="logo">
      <div class="logo-icon">üî¨</div>
      <div>
        <div class="logo-text">Clean Eating Agent</div>
        <div class="logo-sub">P≈ô√≠bram ‚Äî Biomedic√≠nsky audit</div>
      </div>
    </div>
    <div class="header-badge" id="dataBadge">LIVE</div>
  </div>
  <div class="week-info">
    <span class="week-dot"></span>
    <span id="weekInfo">Naƒç√≠tanie...</span>
  </div>
</div>

<div class="cat-nav" id="catNav"></div>
<div class="stats-bar" id="statsBar"></div>
<div class="products" id="productList"></div>
<div class="footer">100% re√°lne d√°ta z let√°kov ¬∑ 0 Kƒç prev√°dzkov√© n√°klady ¬∑ Open Source</div>

<nav class="bottom-nav">
  <button class="nav-item active" data-view="audit"><span class="nav-icon">üî¨</span><span class="nav-label">Audit</span></button>
  <button class="nav-item" data-view="stores"><span class="nav-icon">üè™</span><span class="nav-label">Obchody</span></button>
  <button class="nav-item" data-view="plan"><span class="nav-icon">üìã</span><span class="nav-label">Jed√°lniƒçek</span></button>
</nav>

<script>
// ============================================================
// DATA ‚Äî Inline verified data (fallback if JSON not loaded)
// ============================================================
const VERIFIED_DATA = {"generated_at": "2026-02-10T19:50:00", "verified_source": "Kupi.cz, NajdiSlevu.cz, Kimbino.cz ‚Äî overen√© web searchom 10.2.2026", "store_location": "P≈ô√≠bram", "flyer_week": "9.2.‚Äì15.2.2026", "products": [{"name": "Ku≈ôec√≠ prsn√≠ ≈ô√≠zky", "category": "meat", "is_priority": true, "offers": [{"store": "Lidl", "sale_price": 109.9, "unit": "1 kg", "valid_from": "2026-02-09", "valid_until": "2026-02-11", "note": "baleno, max 5 balen√≠/osoba/den"}, {"store": "Penny Market", "sale_price": 109.9, "unit": "1 kg", "discount_pct": 50, "valid_from": "2026-02-04", "valid_until": "2026-02-10"}, {"store": "Penny Market", "sale_price": 119.9, "unit": "1 kg", "discount_pct": 45, "valid_from": "2026-02-13", "valid_until": "2026-02-15"}, {"store": "Kaufland", "sale_price": 129.9, "unit": "1 kg", "discount_pct": 41, "valid_from": "2026-02-11", "valid_until": "2026-02-17", "note": "pultov√Ω prodej"}], "regular_price": 214.32, "best_price": 109.9, "source_url": "https://www.kupi.cz/sleva/kureci-prsni-rizky", "clean_score": 92, "bio_audit": {"microbiome": {"score": 8, "detail": "ƒåist√© ku≈ôec√≠ maso ‚Äî minim√°ln√≠ vliv na mikrobiom, bohat√© na tryptofan (prekurzor serotoninu)"}, "cardiovascular": {"score": 9, "detail": "N√≠zk√Ω obsah nasycen√Ωch tuk≈Ø, vysok√Ω pod√≠l b√≠lkovin podporuj√≠c√≠ch kardiovaskul√°rn√≠ zdrav√≠"}, "metabolism": {"score": 9, "detail": "Vysok√Ω termick√Ω efekt b√≠lkovin (TEF ~25%), podporuje svalovou synt√©zu a baz√°ln√≠ metabolismus"}}}, {"name": "Ku≈ôe cel√©", "category": "meat", "is_priority": true, "offers": [{"store": "Albert", "sale_price": 59.9, "unit": "1 kg", "valid_from": "2026-02-04", "valid_until": "2026-02-10"}], "regular_price": 90.54, "best_price": 59.9, "source_url": "https://www.kupi.cz/sleva/kure", "clean_score": 88, "bio_audit": {"microbiome": {"score": 7, "detail": "Cel√© ku≈ôe vr√°tane tmav√©ho m√°sa ‚Äî obsahuje v√≠ce kolagenu a glycinu, prospƒõ≈°n√© pro st≈ôevn√≠ stƒõnu"}, "cardiovascular": {"score": 7, "detail": "Tmav√© maso obsahuje v√≠ce ≈æeleza a zinku, k≈Ø≈æe zvy≈°uje obsah nasycen√Ωch tuk≈Ø ‚Äî doporuƒçuji k≈Ø≈æi odebrat"}, "metabolism": {"score": 8, "detail": "Kompletn√≠ aminokyselinov√Ω profil, B-vitam√≠ny (B3, B6) podporuj√≠ energetick√Ω metabolismus"}}}, {"name": "Vep≈ôov√° plec bez kosti", "category": "meat", "is_priority": false, "offers": [{"store": "Penny Market", "sale_price": 69.9, "unit": "1 kg", "discount_pct": 50, "valid_from": "2026-02-04", "valid_until": "2026-02-10"}], "regular_price": 139.0, "best_price": 69.9, "source_url": "https://www.kupi.cz/sleva/veprova-plec", "clean_score": 72, "bio_audit": {"microbiome": {"score": 6, "detail": "Vep≈ôov√© maso ‚Äî neutr√°ln√≠ vliv na mikrobiom, vy≈°≈°√≠ obsah nasycen√Ωch tuk≈Ø ne≈æ dr≈Øbe≈æ"}, "cardiovascular": {"score": 5, "detail": "Vy≈°≈°√≠ pod√≠l nasycen√Ωch tuk≈Ø ‚Äî doporuƒçuji max 2√ó t√Ωdnƒõ, preferovat libov√© ƒç√°sti"}, "metabolism": {"score": 7, "detail": "Dobr√Ω zdroj thiaminu (B1) a selenu, podporuje energetick√Ω metabolismus"}}}, {"name": "Mlet√© maso mix 95%", "category": "meat", "is_priority": false, "offers": [{"store": "Lidl", "sale_price": 119.9, "unit": "1 kg", "valid_from": "2026-02-04", "valid_until": "2026-02-10"}], "regular_price": 189.0, "best_price": 119.9, "source_url": "https://www.kupi.cz/sleva/mleta-smes", "clean_score": 75, "bio_audit": {"microbiome": {"score": 6, "detail": "Mix hovƒõz√≠ho a vep≈ôov√©ho ‚Äî 95% maso je dobr√Ω pomƒõr, bez p≈ôidan√Ωch plnidel"}, "cardiovascular": {"score": 6, "detail": "Smƒõsn√© maso ‚Äî st≈ôedn√≠ obsah tuk≈Ø, z√°le≈æ√≠ na zp≈Øsobu p≈ô√≠pravy"}, "metabolism": {"score": 7, "detail": "Dobr√Ω zdroj ≈æeleza a B12, vysok√Ω pod√≠l b√≠lkovin"}}}, {"name": "Losos filet s k≈Ø≈æ√≠", "category": "fish", "is_priority": true, "offers": [{"store": "Billa", "sale_price": 29.9, "unit": "kus", "discount_pct": 46, "valid_from": "2026-02-11", "valid_until": "2026-02-17"}], "regular_price": 55.0, "best_price": 29.9, "source_url": "https://www.billa.cz", "clean_score": 96, "bio_audit": {"microbiome": {"score": 9, "detail": "Omega-3 mastn√© kyseliny (EPA/DHA) maj√≠ protiz√°nƒõtliv√Ω √∫ƒçinek na st≈ôevn√≠ mikrobiom"}, "cardiovascular": {"score": 10, "detail": "Omega-3 sni≈æuj√≠ triglyceridy, krevn√≠ tlak a riziko arytmi√≠ ‚Äî kardiologov√© doporuƒçuj√≠ 2√ó t√Ωdnƒõ"}, "metabolism": {"score": 9, "detail": "Vysok√Ω obsah vitam√≠nu D a selenu, omega-3 zlep≈°uj√≠ inzul√≠novou citlivost"}}}, {"name": "Franz Josef Tu≈à√°k steak 170/120g", "category": "fish", "is_priority": true, "offers": [{"store": "Billa", "sale_price": 47.9, "unit": "170 g", "discount_pct": 47, "valid_from": "2026-02-04", "valid_until": "2026-02-24"}], "regular_price": 89.9, "best_price": 47.9, "source_url": "https://www.kupi.cz/sleva/tunak-steak-franz-josef", "clean_score": 85, "bio_audit": {"microbiome": {"score": 7, "detail": "Konzervovan√Ω tu≈à√°k ‚Äî minim√°ln√≠ zpracov√°n√≠, pozor na obsah sod√≠ku"}, "cardiovascular": {"score": 8, "detail": "Bohat√Ω na omega-3 a b√≠lkoviny, konzervovan√Ω v oleji dod√° zdrav√© tuky"}, "metabolism": {"score": 8, "detail": "Niacin (B3) a selen podporuj√≠ metabolismus, kompletn√≠ aminokyselinov√Ω profil"}}}, {"name": "Alja≈°sk√° treska Kimbex mra≈æen√°", "category": "fish", "is_priority": true, "offers": [{"store": "Kaufland", "sale_price": 149.9, "unit": "1 kg", "valid_from": "2026-02-04", "valid_until": "2026-02-10"}], "regular_price": 219.0, "best_price": 149.9, "source_url": "https://www.kupi.cz/sleva/file-z-aljasske-tresky", "clean_score": 90, "bio_audit": {"microbiome": {"score": 8, "detail": "ƒåist√© ryb√≠ fil√© bez p≈ô√≠sad ‚Äî neutr√°ln√≠ a≈æ pozitivn√≠ vliv na mikrobiom"}, "cardiovascular": {"score": 8, "detail": "N√≠zkotuƒçn√° ryba s vysok√Ωm pod√≠lem b√≠lkovin, vhodn√° pro sni≈æov√°n√≠ cholesterolu"}, "metabolism": {"score": 8, "detail": "J√≥d podporuje funkci ≈°t√≠tn√© ≈æl√°zy, fosfor je kl√≠ƒçov√Ω pro energetick√Ω metabolismus"}}}, {"name": "Tvaroh tuƒçn√Ω Karlova Koruna 250g", "category": "dairy", "is_priority": true, "offers": [{"store": "Penny Market", "sale_price": 12.9, "unit": "250 g", "discount_pct": 48, "valid_from": "2026-02-04", "valid_until": "2026-02-10"}], "regular_price": 24.9, "best_price": 12.9, "source_url": "https://www.kupi.cz/sleva/tvaroh-tucny-karlova-koruna", "clean_score": 94, "bio_audit": {"microbiome": {"score": 9, "detail": "Tvaroh obsahuje p≈ôirozen√© probiotick√© kultury, kasein ≈æiv√≠ prospƒõ≈°n√© bakterie v tlust√©m st≈ôevƒõ"}, "cardiovascular": {"score": 7, "detail": "Tuƒçn√° varianta ‚Äî vy≈°≈°√≠ obsah nasycen√Ωch tuk≈Ø, ale bohat√Ω na v√°pn√≠k a fosfor"}, "metabolism": {"score": 9, "detail": "Kasein = pomal√© uvol≈àov√°n√≠ aminokyselin, ide√°ln√≠ pro regeneraci sval≈Ø a noƒçn√≠ metabolismus"}}}, {"name": "Mozzarella Pilos 195g", "category": "dairy", "is_priority": true, "offers": [{"store": "Lidl", "sale_price": 12.9, "unit": "195 g", "valid_from": "2026-02-04", "valid_until": "2026-02-10"}], "regular_price": 24.9, "best_price": 12.9, "source_url": "https://www.kupi.cz/sleva/mozzarella-pilos", "clean_score": 88, "bio_audit": {"microbiome": {"score": 7, "detail": "Mozzarella ‚Äî fermentovan√Ω s√Ωr s n√≠zkou lakt√≥zou, ≈°etrn√Ω k mikrobiom"}, "cardiovascular": {"score": 7, "detail": "St≈ôedn√≠ obsah tuk≈Ø, bohat√Ω na v√°pn√≠k ‚Äî prospƒõ≈°n√Ω pro krevn√≠ tlak"}, "metabolism": {"score": 7, "detail": "Kompletn√≠ b√≠lkoviny, v√°pn√≠k podporuje lipol√Ωzu (spalov√°n√≠ tuk≈Ø)"}}}, {"name": "Smetanov√Ω jogurt Zlat√Ω Florian Olma 150g", "category": "dairy", "is_priority": true, "offers": [{"store": "Kaufland", "sale_price": 12.9, "unit": "150 g", "valid_from": "2026-02-04", "valid_until": "2026-02-10"}], "regular_price": 22.9, "best_price": 12.9, "source_url": "https://www.kupi.cz", "clean_score": 82, "bio_audit": {"microbiome": {"score": 8, "detail": "≈Ωiv√© jogurtov√© kultury (L. bulgaricus, S. thermophilus) ‚Äî p≈ô√≠m√° podpora mikrobiom diverzity"}, "cardiovascular": {"score": 6, "detail": "Smetanov√Ω = vy≈°≈°√≠ obsah tuk≈Ø, ale fermentace zlep≈°uje profil mastn√Ωch kyselin"}, "metabolism": {"score": 7, "detail": "Probiotika zlep≈°uj√≠ absorpci ≈æivin a inzul√≠novou citlivost"}}}, {"name": "Selsk√Ω jogurt Hollandia 380g (zraje v kel√≠mku)", "category": "dairy", "is_priority": true, "offers": [{"store": "Kaufland", "sale_price": 13.9, "unit": "380 g", "valid_from": "2026-02-04", "valid_until": "2026-02-10"}], "regular_price": 28.9, "best_price": 13.9, "source_url": "https://www.kupi.cz", "clean_score": 95, "bio_audit": {"microbiome": {"score": 10, "detail": "Zr√°n√≠ v kel√≠mku = ≈æiv√© kultury v pln√© s√≠le, tradiƒçn√≠ v√Ωroba bez p≈ô√≠sad ‚Äî TOP pro mikrobiom"}, "cardiovascular": {"score": 7, "detail": "P≈ôirozen√Ω obsah CLA (konjugovan√° linolov√° kyselina) z ml√©ƒçn√©ho tuku m√° protiz√°nƒõtliv√© √∫ƒçinky"}, "metabolism": {"score": 8, "detail": "Bioaktivn√≠ peptidy z fermentace zlep≈°uj√≠ tr√°ven√≠ a vst≈ôeb√°v√°n√≠ miner√°l≈Ø"}}}, {"name": "Hollandia kr√©mov√Ω jogurt 150g", "category": "dairy", "is_priority": true, "offers": [{"store": "Billa", "sale_price": 9.9, "unit": "150 g", "discount_pct": 34, "valid_from": "2026-01-28", "valid_until": "2026-02-10", "note": "s BILLA Klub"}], "regular_price": 14.9, "best_price": 9.9, "source_url": "https://www.kupi.cz", "clean_score": 80, "bio_audit": {"microbiome": {"score": 7, "detail": "Kr√©mov√Ω jogurt ‚Äî nutno zkontrolovat zda neobsahuje modifikovan√Ω ≈°krob nebo cukr"}, "cardiovascular": {"score": 7, "detail": "Ml√©ƒçn√© b√≠lkoviny a v√°pn√≠k podporuj√≠ zdrav√Ω krevn√≠ tlak"}, "metabolism": {"score": 7, "detail": "Probiotick√© kultury, riboflavin (B2) podporuje energetick√Ω metabolismus"}}}, {"name": "ƒåerstv√° podest√Ωlkov√° vejce M 30ks", "category": "dairy", "is_priority": true, "offers": [{"store": "Kaufland", "sale_price": 149.9, "unit": "30 ks", "valid_from": "2026-02-06", "valid_until": "2026-02-10"}], "regular_price": 189.9, "best_price": 149.9, "source_url": "https://www.kupi.cz/sleva/vejce-m", "clean_score": 98, "bio_audit": {"microbiome": {"score": 8, "detail": "Vejce ‚Äî kompletn√≠ potravina, lecitin podporuje integritu st≈ôevn√≠ bari√©ry"}, "cardiovascular": {"score": 8, "detail": "Nov√° evidence: diet√°rn√≠ cholesterol z vajec m√° minim√°ln√≠ vliv na krevn√≠ cholesterol u zdrav√Ωch jedinc≈Ø"}, "metabolism": {"score": 10, "detail": "Cholin (essential nutrient), kompletn√≠ b√≠lkovina, vitam√≠n D, B12, selen ‚Äî metabolick√Ω superfood"}}}, {"name": "Vejce S podest√Ωlkov√° 30ks", "category": "dairy", "is_priority": true, "offers": [{"store": "Tesco", "sale_price": 129.9, "unit": "30 ks", "valid_from": "2026-02-04", "valid_until": "2026-02-10"}], "regular_price": 169.9, "best_price": 129.9, "source_url": "https://www.kupi.cz/sleva/vejce-s", "clean_score": 98, "bio_audit": {"microbiome": {"score": 8, "detail": "Vejce ‚Äî kompletn√≠ potravina, lecitin podporuje integritu st≈ôevn√≠ bari√©ry"}, "cardiovascular": {"score": 8, "detail": "Nov√° evidence: diet√°rn√≠ cholesterol z vajec m√° minim√°ln√≠ vliv na krevn√≠ cholesterol u zdrav√Ωch jedinc≈Ø"}, "metabolism": {"score": 10, "detail": "Cholin, kompletn√≠ b√≠lkovina, vitam√≠n D, B12, selen ‚Äî metabolick√Ω superfood"}}}, {"name": "Pomeranƒçe", "category": "produce", "is_priority": false, "offers": [{"store": "Lidl", "sale_price": 32.9, "unit": "1 kg", "discount_pct": 45, "valid_from": "2026-02-12", "valid_until": "2026-02-15"}, {"store": "Penny Market", "sale_price": 19.9, "unit": "1 kg", "valid_from": "2026-02-04", "valid_until": "2026-02-10"}], "regular_price": 59.9, "best_price": 19.9, "source_url": "https://www.kupi.cz/sleva/pomerance", "clean_score": 100, "bio_audit": {"microbiome": {"score": 9, "detail": "Bohat√Ω zdroj pektinu ‚Äî rozpustn√© vl√°kniny, kter√° ≈æiv√≠ Bifidobacterium v tlust√©m st≈ôevƒõ"}, "cardiovascular": {"score": 9, "detail": "Vitam√≠n C, hesperidin a naringenin ‚Äî flavonoidy sni≈æuj√≠c√≠ krevn√≠ tlak a z√°nƒõt c√©v"}, "metabolism": {"score": 8, "detail": "Vitam√≠n C zvy≈°uje absorpci ≈æeleza, fol√°t podporuje bunƒõƒçn√Ω metabolismus"}}}, {"name": "Ban√°ny", "category": "produce", "is_priority": false, "offers": [{"store": "Penny Market", "sale_price": 24.9, "unit": "1 kg", "valid_from": "2026-02-04", "valid_until": "2026-02-10"}, {"store": "Billa", "sale_price": 24.9, "unit": "1 kg", "valid_from": "2026-01-28", "valid_until": "2026-02-10"}], "regular_price": 34.9, "best_price": 24.9, "source_url": "https://www.kupi.cz/sleva/banany", "clean_score": 100, "bio_audit": {"microbiome": {"score": 9, "detail": "Rezistentn√≠ ≈°krob (zejm√©na nezral√© ban√°ny) je prebiotikum pro prospƒõ≈°n√© st≈ôevn√≠ bakterie"}, "cardiovascular": {"score": 8, "detail": "Drasl√≠k (358mg/100g) reguluje krevn√≠ tlak, vitam√≠n B6 sni≈æuje homocystein"}, "metabolism": {"score": 7, "detail": "Rychl√Ω zdroj energie (GI 51), vhodn√Ω post-workout, B6 podporuje metabolismus b√≠lkovin"}}}, {"name": "Hrozny tmav√©/r≈Ø≈æov√© bezsemenn√© 500g", "category": "produce", "is_priority": false, "offers": [{"store": "Penny Market", "sale_price": 37.9, "unit": "500 g", "valid_from": "2026-02-04", "valid_until": "2026-02-10"}, {"store": "Lidl", "sale_price": 37.9, "unit": "500 g", "valid_from": "2026-02-04", "valid_until": "2026-02-10"}], "regular_price": 69.9, "best_price": 37.9, "source_url": "https://www.kupi.cz", "clean_score": 100, "bio_audit": {"microbiome": {"score": 8, "detail": "Polyfenoly (resveratrol) z hrozn≈Ø podporuj√≠ r≈Øst Akkermansia muciniphila"}, "cardiovascular": {"score": 9, "detail": "Resveratrol a proanthocyanidiny ‚Äî siln√© kardioprotektivn√≠ √∫ƒçinky"}, "metabolism": {"score": 7, "detail": "Vy≈°≈°√≠ obsah cukr≈Ø (GI 59), ale bohat√© na antioxidanty"}}}, {"name": "Mrkev", "category": "produce", "is_priority": false, "offers": [{"store": "Penny Market", "sale_price": 11.9, "unit": "1 kg", "valid_from": "2026-02-04", "valid_until": "2026-02-10"}], "regular_price": 24.9, "best_price": 11.9, "source_url": "https://www.kupi.cz/sleva/mrkev", "clean_score": 100, "bio_audit": {"microbiome": {"score": 8, "detail": "Bohat√° na vl√°kninu a beta-karoten, podporuje diverzitu st≈ôevn√≠ho mikrobiomu"}, "cardiovascular": {"score": 8, "detail": "Beta-karoten a luteolin maj√≠ antioxidaƒçn√≠ √∫ƒçinky na c√©vy"}, "metabolism": {"score": 8, "detail": "N√≠zkokalorick√° (41 kcal/100g), beta-karoten se p≈ôemƒõ≈àuje na vitam√≠n A"}}}, {"name": "Sal√°tov√° okurka", "category": "produce", "is_priority": false, "offers": [{"store": "Penny Market", "sale_price": 17.9, "unit": "1 ks", "valid_from": "2026-02-04", "valid_until": "2026-02-10"}, {"store": "Tesco", "sale_price": 17.9, "unit": "1 ks", "valid_from": "2026-02-04", "valid_until": "2026-02-10"}], "regular_price": 29.9, "best_price": 17.9, "source_url": "https://www.kupi.cz/sleva/okurka-salatova", "clean_score": 100, "bio_audit": {"microbiome": {"score": 7, "detail": "Vysok√Ω obsah vody (96%), vl√°knina ze slupky podporuje peristaltiku"}, "cardiovascular": {"score": 7, "detail": "Drasl√≠k, ho≈ôƒç√≠k a kukurbitaciny ‚Äî p≈ôirozen√© protiz√°nƒõtliv√© l√°tky"}, "metabolism": {"score": 9, "detail": "Prakticky bez kalori√≠ (15 kcal/100g), ide√°ln√≠ pro hydrataci a detoxifikaci"}}}, {"name": "Extra sladk√© zlat√© kiwi", "category": "produce", "is_priority": false, "offers": [{"store": "Penny Market", "sale_price": 8.9, "unit": "1 ks", "valid_from": "2026-02-04", "valid_until": "2026-02-10"}], "regular_price": 14.9, "best_price": 8.9, "source_url": "https://www.kupi.cz", "clean_score": 100, "bio_audit": {"microbiome": {"score": 9, "detail": "Enzym actinidin zlep≈°uje tr√°ven√≠ b√≠lkovin, vysok√Ω obsah vl√°kniny pro mikrobiom"}, "cardiovascular": {"score": 9, "detail": "Vitam√≠n C (92mg/100g), vitam√≠n K a drasl√≠k ‚Äî siln√° kardioprotekce"}, "metabolism": {"score": 9, "detail": "N√≠zk√Ω GI (50), bohat√© na fol√°t a vitam√≠n E"}}}, {"name": "Borges Olivov√Ω olej extra mild 500ml", "category": "pantry", "is_priority": true, "offers": [{"store": "Billa", "sale_price": 159.9, "unit": "500 ml", "discount_pct": 47, "valid_from": "2026-01-21", "valid_until": "2026-02-10"}], "regular_price": 299.9, "best_price": 159.9, "source_url": "https://www.kupi.cz", "clean_score": 85, "bio_audit": {"microbiome": {"score": 8, "detail": "Polyfenoly olivov√©ho oleje (oleocanthal, oleuropein) podporuj√≠ prospƒõ≈°n√© bakterie"}, "cardiovascular": {"score": 10, "detail": "Kyselina olejov√° (73%) ‚Äî z√°klad st≈ôedomo≈ôsk√© diety, sni≈æuje LDL a z√°nƒõt c√©v"}, "metabolism": {"score": 8, "detail": "Mononenasycen√© tuky zlep≈°uj√≠ inzul√≠novou citlivost a metabolismus tuk≈Ø"}}}]};

// Store class mappings
const STORE_CLASS = {
  'Lidl': 'lidl',
  'Kaufland': 'kaufland',
  'Penny Market': 'penny',
  'Billa': 'billa',
  'Albert': 'albert',
  'Tesco': 'tesco',
};

const CAT_LABELS = {
  all: { icon: 'üõí', label: 'V≈°etko' },
  meat: { icon: 'ü•©', label: 'M√§so' },
  fish: { icon: 'üêü', label: 'Ryby' },
  dairy: { icon: 'ü•õ', label: 'Mlieƒçne' },
  produce: { icon: 'ü•¨', label: 'Ovocie & Zelenina' },
  pantry: { icon: 'ü´ò', label: 'Trvanliv√©' },
};

const BIO_ICONS = {
  microbiome: 'ü¶†',
  cardiovascular: '‚ù§Ô∏è',
  metabolism: '‚ö°',
};

const BIO_LABELS = {
  microbiome: 'Mikrobi√≥m',
  cardiovascular: 'Kardiovaskul√°rne',
  metabolism: 'Metabolizmus',
};

// ============================================================
// APP STATE
// ============================================================
let appData = null;
let activeCategory = 'all';

// ============================================================
// LOAD DATA
// ============================================================
async function loadData() {
  // Try fetching from data/ directory first (for GitHub Pages deployment)
  try {
    const resp = await fetch('../data/products_verified_2026-02-10.json');
    if (resp.ok) {
      appData = await resp.json();
      document.getElementById('dataBadge').textContent = 'LIVE';
      render();
      return;
    }
  } catch(e) {}

  // Try alternative paths
  try {
    const resp = await fetch('data/products_verified_2026-02-10.json');
    if (resp.ok) {
      appData = await resp.json();
      render();
      return;
    }
  } catch(e) {}

  // Fallback to inline data
  appData = VERIFIED_DATA;
  document.getElementById('dataBadge').textContent = 'OFFLINE';
  render();
}

// ============================================================
// RENDER
// ============================================================
function render() {
  renderWeekInfo();
  renderCategories();
  renderStats();
  renderProducts();
}

function renderWeekInfo() {
  const el = document.getElementById('weekInfo');
  if (appData?.flyer_week) {
    el.textContent = `Let√°k ${appData.flyer_week} ¬∑ Overen√© ${new Date(appData.generated_at).toLocaleDateString('cs-CZ')}`;
  } else {
    el.textContent = `Aktualizovan√© ${new Date().toLocaleDateString('cs-CZ')}`;
  }
}

function renderCategories() {
  const nav = document.getElementById('catNav');
  const products = appData?.products || [];
  
  // Count per category
  const counts = { all: products.length };
  products.forEach(p => {
    counts[p.category] = (counts[p.category] || 0) + 1;
  });
  
  nav.innerHTML = Object.entries(CAT_LABELS)
    .filter(([key]) => key === 'all' || counts[key])
    .map(([key, {icon, label}]) => `
      <button class="cat-btn ${key === activeCategory ? 'active' : ''}" data-cat="${key}">
        ${icon} ${label} <span class="count">${counts[key] || 0}</span>
      </button>
    `).join('');
  
  nav.querySelectorAll('.cat-btn').forEach(btn => {
    btn.addEventListener('click', () => {
      activeCategory = btn.dataset.cat;
      render();
    });
  });
}

function renderStats() {
  const bar = document.getElementById('statsBar');
  const products = getFilteredProducts();
  
  const withPrice = products.filter(p => p.best_price);
  const avgDiscount = products.reduce((s, p) => s + (p.max_discount || 0), 0) / Math.max(products.length, 1);
  const avgScore = products.reduce((s, p) => s + (p.clean_score || 0), 0) / Math.max(products.length, 1);
  
  bar.innerHTML = `
    <div class="stat-card">
      <div class="stat-val">${products.length}</div>
      <div class="stat-label">Clean produktov</div>
    </div>
    <div class="stat-card">
      <div class="stat-val" style="color:var(--yellow)">-${Math.round(avgDiscount)}%</div>
      <div class="stat-label">√ò zƒæava</div>
    </div>
    <div class="stat-card">
      <div class="stat-val" style="color:var(--green)">${Math.round(avgScore)}</div>
      <div class="stat-label">√ò Clean Score</div>
    </div>
  `;
}

function getFilteredProducts() {
  const products = appData?.products || [];
  if (activeCategory === 'all') return products;
  return products.filter(p => p.category === activeCategory);
}

function getScoreColor(score) {
  if (score >= 90) return 'var(--green)';
  if (score >= 75) return 'var(--accent)';
  if (score >= 60) return 'var(--yellow)';
  return 'var(--orange)';
}

function getBioScoreColor(score) {
  if (score >= 8) return 'var(--green)';
  if (score >= 6) return 'var(--accent)';
  if (score >= 4) return 'var(--yellow)';
  return 'var(--red)';
}

function getValidityClass(offer) {
  if (!offer.valid_until) return '';
  const end = new Date(offer.valid_until);
  const today = new Date();
  const diff = (end - today) / (1000 * 60 * 60 * 24);
  if (diff < 0) return 'ended';
  if (diff <= 1) return 'ending';
  return 'active';
}

function getValidityText(offer) {
  if (!offer.valid_until) return '';
  const end = new Date(offer.valid_until);
  const today = new Date();
  today.setHours(0,0,0,0);
  const diff = Math.ceil((end - today) / (1000 * 60 * 60 * 24));
  if (diff < 0) return 'Ukonƒçen√©';
  if (diff === 0) return 'Dnes posledn√Ω de≈à!';
  if (diff === 1) return 'Zajtra konƒç√≠!';
  return `Do ${end.toLocaleDateString('cs-CZ', { day: 'numeric', month: 'numeric' })}`;
}

function renderProducts() {
  const container = document.getElementById('productList');
  const products = getFilteredProducts();
  
  if (!products.length) {
    container.innerHTML = `
      <div class="empty fade-in">
        <div class="empty-icon">üîç</div>
        <div class="empty-title">≈Ωiadne produkty</div>
        <div>V tejto kateg√≥rii neboli n√°jden√© akciov√© clean produkty.</div>
      </div>
    `;
    return;
  }
  
  // Sort: priority first, then by clean score
  const sorted = [...products].sort((a, b) => {
    if (a.is_priority !== b.is_priority) return b.is_priority ? 1 : -1;
    return (b.clean_score || 0) - (a.clean_score || 0);
  });
  
  container.innerHTML = sorted.map((p, i) => {
    const score = p.clean_score || 0;
    const color = getScoreColor(score);
    const circumference = 2 * Math.PI * 22;
    const offset = circumference - (score / 100) * circumference;
    
    // Best offer
    const bestOffer = p.offers?.reduce((best, o) => !best || o.sale_price < best.sale_price ? o : best, null);
    
    const cardId = `card-${i}`;
    
    return `
      <div class="product-card card-enter" style="animation-delay:${i * 0.05}s">
        <div class="product-main">
          <div class="score-ring">
            <svg width="52" height="52" viewBox="0 0 52 52">
              <circle class="track" cx="26" cy="26" r="22"/>
              <circle class="fill" cx="26" cy="26" r="22" 
                stroke="${color}" 
                stroke-dasharray="${circumference}" 
                stroke-dashoffset="${offset}"/>
            </svg>
            <div class="score-val" style="color:${color}">${score}</div>
          </div>
          
          <div class="product-info">
            <div class="product-name">${p.is_priority ? '‚≠ê ' : ''}${p.name}</div>
            <div class="product-meta">${CAT_LABELS[p.category]?.icon || ''} ${CAT_LABELS[p.category]?.label || p.category}</div>
            
            ${bestOffer ? `
              <div class="price-row">
                <span class="price-sale">${bestOffer.sale_price.toFixed(2).replace('.', ',')} Kƒç</span>
                <span class="price-unit">/ ${bestOffer.unit || 'ks'}</span>
                ${p.regular_price ? `<span class="price-original">${p.regular_price.toFixed(2).replace('.', ',')} Kƒç</span>` : ''}
                ${p.max_discount ? `<span class="price-discount">-${p.max_discount}%</span>` : ''}
              </div>
            ` : '<div class="price-row"><span style="font-size:12px;color:var(--text2)">Aktu√°lne bez let√°kovej akcie</span></div>'}
            
            <div class="store-badges">
              ${(p.offers || []).map(o => {
                const cls = STORE_CLASS[o.store] || '';
                const validity = getValidityClass(o);
                const validText = getValidityText(o);
                return `<div class="store-badge ${cls}">
                  ${o.store} <span class="badge-price">${o.sale_price.toFixed(2).replace('.', ',')} Kƒç</span>
                  ${validText ? `<span style="font-size:9px;opacity:0.7"> ¬∑ ${validText}</span>` : ''}
                </div>`;
              }).join('')}
            </div>
            
            ${p.source_url ? `<a class="source-link" href="${p.source_url}" target="_blank">üîó Overi≈• na Kupi.cz</a>` : ''}
          </div>
        </div>
        
        ${p.bio_audit ? `
          <div class="bio-toggle" onclick="toggleBio('${cardId}', this)">
            üî¨ Biomedic√≠nsky audit
            <span class="arrow">‚ñº</span>
          </div>
          <div class="bio-panel" id="${cardId}">
            <div class="bio-content">
              ${Object.entries(p.bio_audit).map(([key, val]) => {
                const scoreW = val.score * 10;
                const barColor = getBioScoreColor(val.score);
                return `
                  <div class="bio-item">
                    <div class="bio-icon">${BIO_ICONS[key] || 'üìä'}</div>
                    <div style="flex:1">
                      <div class="bio-label">${BIO_LABELS[key] || key} ‚Äî ${val.score}/10</div>
                      <div class="bio-score-bar"><div class="bio-score-fill" style="width:${scoreW}%;background:${barColor}"></div></div>
                      <div class="bio-detail">${val.detail}</div>
                    </div>
                  </div>
                `;
              }).join('')}
            </div>
          </div>
        ` : ''}
      </div>
    `;
  }).join('');
}

function toggleBio(id, toggleEl) {
  const panel = document.getElementById(id);
  const isOpen = panel.classList.contains('open');
  
  // Close all other panels
  document.querySelectorAll('.bio-panel.open').forEach(p => {
    p.classList.remove('open');
    p.previousElementSibling.classList.remove('open');
  });
  
  if (!isOpen) {
    panel.classList.add('open');
    toggleEl.classList.add('open');
  }
}

// ============================================================
// SERVICE WORKER
// ============================================================
if ('serviceWorker' in navigator) {
  navigator.serviceWorker.register('./sw.js').catch(() => {});
}

// ============================================================
// INIT
// ============================================================
loadData();
</script>
</body>
</html>
