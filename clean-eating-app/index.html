<!DOCTYPE html>
<html lang="sk">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover, user-scalable=no">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="theme-color" content="#0a0f1a">
<title>Clean Eating Agent ‚Äî P≈ô√≠bram</title>
<link rel="manifest" href="manifest.json">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=DM+Sans:ital,wght@0,400;0,500;0,700&family=JetBrains+Mono:wght@500&display=swap" rel="stylesheet">
<style>
:root {
  --bg: #0a0f1a; --bg2: #111827; --bg3: #1a2236;
  --surface: #1e2a3e; --border: #2a3654;
  --text: #e8ecf4; --text2: #8b97b0;
  --accent: #22d3ee; --accent2: #06b6d4;
  --green: #34d399; --yellow: #fbbf24; --red: #f87171; --orange: #fb923c; --purple: #a78bfa;
  --safe-top: env(safe-area-inset-top, 0px); --safe-bottom: env(safe-area-inset-bottom, 0px);
}
* { margin:0; padding:0; box-sizing:border-box; -webkit-tap-highlight-color:transparent; }
html { font-family:'DM Sans',-apple-system,sans-serif; background:var(--bg); color:var(--text); }
body { min-height:100dvh; padding-top:var(--safe-top); padding-bottom:calc(72px + var(--safe-bottom)); overflow-x:hidden; }

.header { position:sticky; top:0; z-index:100; background:rgba(10,15,26,0.85); backdrop-filter:blur(20px) saturate(180%); -webkit-backdrop-filter:blur(20px) saturate(180%); padding:calc(var(--safe-top)+12px) 20px 12px; border-bottom:1px solid var(--border); }
.header-top { display:flex; align-items:center; justify-content:space-between; margin-bottom:8px; }
.logo { display:flex; align-items:center; gap:10px; }
.logo-icon { width:36px; height:36px; background:linear-gradient(135deg,var(--accent),var(--green)); border-radius:10px; display:flex; align-items:center; justify-content:center; font-size:18px; }
.logo-text { font-size:17px; font-weight:700; letter-spacing:-0.3px; }
.logo-sub { font-size:11px; color:var(--text2); font-weight:500; }
.header-badge { font-family:'JetBrains Mono',monospace; font-size:10px; background:rgba(34,211,238,0.15); color:var(--accent); padding:4px 10px; border-radius:20px; border:1px solid rgba(34,211,238,0.3); }
.week-info { font-size:12px; color:var(--text2); display:flex; align-items:center; gap:6px; }
.week-dot { width:6px; height:6px; background:var(--green); border-radius:50%; animation:pulse 2s infinite; }
@keyframes pulse { 0%,100%{opacity:1} 50%{opacity:0.4} }

.cat-nav { display:flex; gap:8px; padding:16px 20px 8px; overflow-x:auto; scrollbar-width:none; -webkit-overflow-scrolling:touch; }
.cat-nav::-webkit-scrollbar { display:none; }
.cat-btn { flex-shrink:0; padding:10px 18px; border-radius:24px; border:1px solid var(--border); background:var(--bg2); color:var(--text2); font-size:13px; font-weight:600; cursor:pointer; display:flex; align-items:center; gap:6px; transition:all 0.2s; font-family:inherit; }
.cat-btn.active { background:var(--accent); color:var(--bg); border-color:var(--accent); }
.cat-btn .count { font-family:'JetBrains Mono',monospace; font-size:11px; opacity:0.7; }

.stats-bar { display:grid; grid-template-columns:repeat(3,1fr); gap:10px; padding:12px 20px; }
.stat-card { background:var(--bg2); border:1px solid var(--border); border-radius:14px; padding:12px; text-align:center; }
.stat-val { font-family:'JetBrains Mono',monospace; font-size:20px; font-weight:700; color:var(--accent); }
.stat-label { font-size:10px; color:var(--text2); margin-top:2px; text-transform:uppercase; letter-spacing:0.5px; }

.content { padding:8px 20px; display:flex; flex-direction:column; gap:12px; }

.product-card { background:var(--bg2); border:1px solid var(--border); border-radius:16px; overflow:hidden; transition:transform 0.2s; }
.product-card:active { transform:scale(0.98); }
.product-main { padding:16px; display:flex; gap:14px; align-items:flex-start; }
.score-ring { width:52px; height:52px; flex-shrink:0; position:relative; }
.score-ring svg { transform:rotate(-90deg); }
.score-ring circle { fill:none; stroke-width:4; }
.score-ring .track { stroke:var(--bg3); }
.score-ring .fill { stroke-linecap:round; transition:stroke-dashoffset 0.8s ease; }
.score-val { position:absolute; inset:0; display:flex; align-items:center; justify-content:center; font-family:'JetBrains Mono',monospace; font-size:14px; font-weight:700; }
.product-info { flex:1; min-width:0; }
.product-name { font-size:15px; font-weight:700; line-height:1.3; margin-bottom:4px; }
.product-meta { font-size:12px; color:var(--text2); margin-bottom:8px; }
.price-row { display:flex; align-items:baseline; gap:8px; flex-wrap:wrap; }
.price-sale { font-family:'JetBrains Mono',monospace; font-size:20px; font-weight:700; color:var(--green); }
.price-unit { font-size:11px; color:var(--text2); }
.price-original { font-size:12px; color:var(--text2); text-decoration:line-through; }
.price-discount { font-family:'JetBrains Mono',monospace; font-size:11px; font-weight:600; background:rgba(251,191,36,0.15); color:var(--yellow); padding:2px 8px; border-radius:10px; }
.store-badges { display:flex; gap:6px; margin-top:10px; flex-wrap:wrap; }
.store-badge { font-size:11px; font-weight:600; padding:4px 10px; border-radius:8px; display:flex; align-items:center; gap:4px; }
.store-badge.lidl { background:rgba(0,80,170,0.2); color:#4da3ff; border:1px solid rgba(0,80,170,0.3); }
.store-badge.kaufland { background:rgba(225,9,21,0.15); color:#ff6b6b; border:1px solid rgba(225,9,21,0.25); }
.store-badge.penny { background:rgba(205,23,25,0.15); color:#ff8080; border:1px solid rgba(205,23,25,0.25); }
.store-badge.billa { background:rgba(245,225,0,0.15); color:#f5e100; border:1px solid rgba(245,225,0,0.25); }
.store-badge.albert { background:rgba(226,0,26,0.15); color:#ff7070; border:1px solid rgba(226,0,26,0.25); }

.nutrition-bar { display:flex; gap:2px; padding:0 16px 12px; }
.nutri-item { flex:1; text-align:center; background:var(--bg3); padding:8px 4px; border-radius:8px; }
.nutri-item:first-child { border-radius:8px 4px 4px 8px; }
.nutri-item:last-child { border-radius:4px 8px 8px 4px; }
.nutri-val { font-family:'JetBrains Mono',monospace; font-size:13px; font-weight:700; }
.nutri-label { font-size:9px; color:var(--text2); text-transform:uppercase; letter-spacing:0.3px; margin-top:2px; }
.nutri-per100 { font-size:9px; color:var(--text2); padding:0 16px 8px; text-align:right; font-style:italic; }

.bio-toggle { display:flex; align-items:center; justify-content:space-between; padding:10px 16px; border-top:1px solid var(--border); cursor:pointer; font-size:12px; color:var(--accent); font-weight:600; }
.bio-toggle .arrow { transition:transform 0.3s; font-size:14px; }
.bio-toggle.open .arrow { transform:rotate(180deg); }
.bio-panel { max-height:0; overflow:hidden; transition:max-height 0.4s ease; background:rgba(34,211,238,0.03); }
.bio-panel.open { max-height:500px; }
.bio-content { padding:12px 16px; display:flex; flex-direction:column; gap:10px; }
.bio-item { display:flex; gap:10px; align-items:flex-start; }
.bio-icon { font-size:16px; flex-shrink:0; width:24px; text-align:center; margin-top:1px; }
.bio-label { font-size:11px; font-weight:700; text-transform:uppercase; letter-spacing:0.5px; color:var(--text2); margin-bottom:2px; }
.bio-score-bar { height:4px; border-radius:2px; background:var(--bg3); margin:4px 0; }
.bio-score-fill { height:100%; border-radius:2px; transition:width 0.6s ease; }
.bio-detail { font-size:11px; color:var(--text2); line-height:1.5; }
.source-link { display:inline-flex; align-items:center; gap:4px; font-size:10px; color:var(--text2); text-decoration:none; margin-top:6px; opacity:0.6; transition:opacity 0.2s; }
.source-link:hover { opacity:1; }

/* STORES VIEW */
.store-group { background:var(--bg2); border:1px solid var(--border); border-radius:16px; overflow:hidden; }
.store-group-header { padding:16px; display:flex; align-items:center; gap:12px; border-bottom:1px solid var(--border); }
.store-group-icon { width:40px; height:40px; border-radius:10px; display:flex; align-items:center; justify-content:center; font-size:20px; font-weight:700; }
.store-group-name { font-size:16px; font-weight:700; }
.store-group-count { font-size:12px; color:var(--text2); }
.store-product { padding:12px 16px; border-bottom:1px solid rgba(42,54,84,0.5); display:flex; justify-content:space-between; align-items:center; }
.store-product:last-child { border-bottom:none; }
.sp-name { font-size:13px; font-weight:600; }
.sp-meta { font-size:11px; color:var(--text2); margin-top:2px; }
.sp-price { font-family:'JetBrains Mono',monospace; font-size:16px; font-weight:700; color:var(--green); text-align:right; }
.sp-discount { font-size:10px; color:var(--yellow); }

/* MEAL PLAN VIEW */
.meal-card { background:var(--bg2); border:1px solid var(--border); border-radius:16px; overflow:hidden; }
.meal-header { padding:16px; border-bottom:1px solid var(--border); }
.meal-type { font-size:11px; font-weight:700; text-transform:uppercase; letter-spacing:0.5px; color:var(--accent); margin-bottom:4px; }
.meal-title { font-size:17px; font-weight:700; }
.meal-desc { font-size:12px; color:var(--text2); margin-top:4px; line-height:1.5; }
.meal-ingredients { padding:12px 16px; }
.meal-ing-title { font-size:11px; font-weight:700; text-transform:uppercase; color:var(--text2); margin-bottom:8px; }
.meal-ing-row { font-size:12px; color:var(--text); padding:4px 0; display:flex; justify-content:space-between; }
.meal-ing-row .mi-price { font-family:'JetBrains Mono',monospace; color:var(--green); font-size:11px; }
.meal-steps { padding:12px 16px; border-top:1px solid var(--border); }
.meal-steps-title { font-size:11px; font-weight:700; text-transform:uppercase; color:var(--text2); margin-bottom:8px; }
.meal-step { font-size:12px; color:var(--text2); padding:4px 0; line-height:1.5; }
.meal-step b { color:var(--text); font-weight:600; }
.meal-total { padding:12px 16px; border-top:1px solid var(--border); display:flex; justify-content:space-between; align-items:center; }
.meal-total-label { font-size:12px; color:var(--text2); }
.meal-total-price { font-family:'JetBrains Mono',monospace; font-size:18px; font-weight:700; color:var(--green); }
.day-total { background:linear-gradient(135deg, rgba(34,211,238,0.1), rgba(52,211,153,0.1)); border:1px solid rgba(34,211,238,0.3); border-radius:16px; padding:20px; text-align:center; }
.day-total-title { font-size:13px; font-weight:700; color:var(--accent); text-transform:uppercase; letter-spacing:0.5px; margin-bottom:12px; }
.day-total-grid { display:grid; grid-template-columns:repeat(4,1fr); gap:8px; }
.dt-item .dt-val { font-family:'JetBrains Mono',monospace; font-size:18px; font-weight:700; }
.dt-item .dt-label { font-size:9px; color:var(--text2); text-transform:uppercase; margin-top:2px; }

.bottom-nav { position:fixed; bottom:0; left:0; right:0; z-index:100; background:rgba(10,15,26,0.92); backdrop-filter:blur(20px); -webkit-backdrop-filter:blur(20px); border-top:1px solid var(--border); display:flex; padding:8px 20px calc(8px + var(--safe-bottom)); }
.nav-item { flex:1; display:flex; flex-direction:column; align-items:center; gap:4px; padding:6px; border-radius:12px; cursor:pointer; transition:all 0.2s; background:none; border:none; color:var(--text2); font-family:inherit; }
.nav-item.active { color:var(--accent); }
.nav-icon { font-size:20px; }
.nav-label { font-size:10px; font-weight:600; }

.empty { text-align:center; padding:40px 20px; color:var(--text2); }
.empty-icon { font-size:48px; margin-bottom:12px; }
.empty-title { font-size:16px; font-weight:700; color:var(--text); margin-bottom:4px; }
.footer { text-align:center; padding:24px 20px 12px; font-size:11px; color:var(--text2); opacity:0.5; }
.hidden { display:none !important; }
.fade-in { animation:fadeIn 0.4s ease; }
@keyframes fadeIn { from{opacity:0;transform:translateY(8px)} to{opacity:1;transform:translateY(0)} }
.card-enter { animation:cardEnter 0.3s ease backwards; }
@keyframes cardEnter { from{opacity:0;transform:translateY(16px)} }
</style>
</head>
<body>

<div class="header">
  <div class="header-top">
    <div class="logo">
      <div class="logo-icon">üî¨</div>
      <div><div class="logo-text">Clean Eating Agent</div><div class="logo-sub">P≈ô√≠bram ‚Äî Biomedic√≠nsky audit</div></div>
    </div>
    <div class="header-badge" id="dataBadge">LIVE</div>
  </div>
  <div class="week-info"><span class="week-dot"></span><span id="weekInfo">Naƒç√≠tanie...</span></div>
</div>

<div id="viewAudit">
  <div class="cat-nav" id="catNav"></div>
  <div class="stats-bar" id="statsBar"></div>
  <div class="content" id="productList"></div>
</div>

<div id="viewStores" class="hidden">
  <div class="content" id="storeList" style="padding-top:16px"></div>
</div>

<div id="viewPlan" class="hidden">
  <div class="content" id="mealPlan" style="padding-top:16px"></div>
</div>

<div class="footer">100% re√°lne d√°ta z let√°kov ¬∑ 0 Kƒç prev√°dzkov√© n√°klady</div>

<nav class="bottom-nav">
  <button class="nav-item active" data-view="audit"><span class="nav-icon">üî¨</span><span class="nav-label">Audit</span></button>
  <button class="nav-item" data-view="stores"><span class="nav-icon">üè™</span><span class="nav-label">Obchody</span></button>
  <button class="nav-item" data-view="plan"><span class="nav-icon">üìã</span><span class="nav-label">Jed√°lniƒçek</span></button>
</nav>

<script>
const STORE_CLASS = {'Lidl':'lidl','Kaufland':'kaufland','Penny Market':'penny','Billa':'billa','Albert':'albert'};
const STORE_COLORS = {'Lidl':'#4da3ff','Kaufland':'#ff6b6b','Penny Market':'#ff8080','Billa':'#f5e100','Albert':'#ff7070'};
const STORE_ICONS = {'Lidl':'üîµ','Kaufland':'üî¥','Penny Market':'üü°','Billa':'üü°','Albert':'üî¥'};
const CAT_LABELS = {all:{icon:'üõí',label:'V≈°etko'},meat:{icon:'ü•©',label:'M√§so'},fish:{icon:'üêü',label:'Ryby'},dairy:{icon:'ü•õ',label:'Mlieƒçne'},produce:{icon:'ü•¨',label:'Ovocie & Zelenina'},pantry:{icon:'ü´ò',label:'Trvanliv√©'}};
const BIO_ICONS = {microbiome:'ü¶†',cardiovascular:'‚ù§Ô∏è',metabolism:'‚ö°'};
const BIO_LABELS = {microbiome:'Mikrobi√≥m',cardiovascular:'Kardiovaskul√°rne',metabolism:'Metabolizmus'};

let appData = null, activeCategory = 'all', activeView = 'audit';

// ===================== NAV SWITCHING =====================
document.querySelectorAll('.nav-item').forEach(btn => {
  btn.addEventListener('click', () => {
    activeView = btn.dataset.view;
    document.querySelectorAll('.nav-item').forEach(b => b.classList.remove('active'));
    btn.classList.add('active');
    document.getElementById('viewAudit').classList.toggle('hidden', activeView !== 'audit');
    document.getElementById('viewStores').classList.toggle('hidden', activeView !== 'stores');
    document.getElementById('viewPlan').classList.toggle('hidden', activeView !== 'plan');
    if (activeView === 'stores') renderStores();
    if (activeView === 'plan') renderMealPlan();
  });
});

// ===================== DATA LOADING =====================
async function loadData() {
  const paths = [
    '../data/products_verified_2026-02-10.json',
    'data/products_verified_2026-02-10.json',
    './data/products_verified_2026-02-10.json'
  ];
  for (const path of paths) {
    try {
      const r = await fetch(path);
      if (r.ok) { appData = await r.json(); render(); return; }
    } catch(e) {}
  }
  // Fallback to embedded data
  appData = EMBEDDED_DATA;
  document.getElementById('dataBadge').textContent = 'OFFLINE';
  render();
}

// ===================== AUDIT VIEW =====================
function render() { renderWeekInfo(); renderCategories(); renderStats(); renderProducts(); }

function renderWeekInfo() {
  const el = document.getElementById('weekInfo');
  el.textContent = appData?.flyer_week
    ? 'Let√°k ' + appData.flyer_week + ' ¬∑ Overen√© ' + new Date(appData.generated_at).toLocaleDateString('cs-CZ')
    : 'Aktualizovan√© ' + new Date().toLocaleDateString('cs-CZ');
}

function renderCategories() {
  const nav = document.getElementById('catNav');
  const products = appData?.products || [];
  const counts = { all: products.length };
  products.forEach(p => { counts[p.category] = (counts[p.category] || 0) + 1; });
  nav.innerHTML = Object.entries(CAT_LABELS)
    .filter(([k]) => k === 'all' || counts[k])
    .map(([k, { icon, label }]) =>
      '<button class="cat-btn ' + (k === activeCategory ? 'active' : '') + '" data-cat="' + k + '">' +
      icon + ' ' + label + ' <span class="count">' + (counts[k] || 0) + '</span></button>'
    ).join('');
  nav.querySelectorAll('.cat-btn').forEach(b => {
    b.addEventListener('click', () => { activeCategory = b.dataset.cat; render(); });
  });
}

function renderStats() {
  const products = getFiltered();
  const len = Math.max(products.length, 1);
  const avgDisc = products.reduce((s, p) => s + (p.max_discount || 0), 0) / len;
  const avgScore = products.reduce((s, p) => s + (p.clean_score || 0), 0) / len;
  document.getElementById('statsBar').innerHTML =
    '<div class="stat-card"><div class="stat-val">' + products.length + '</div><div class="stat-label">Clean produktov</div></div>' +
    '<div class="stat-card"><div class="stat-val" style="color:var(--yellow)">-' + Math.round(avgDisc) + '%</div><div class="stat-label">√ò zƒæava</div></div>' +
    '<div class="stat-card"><div class="stat-val" style="color:var(--green)">' + Math.round(avgScore) + '</div><div class="stat-label">√ò Clean Score</div></div>';
}

function getFiltered() {
  const p = appData?.products || [];
  return activeCategory === 'all' ? p : p.filter(x => x.category === activeCategory);
}

function scoreColor(s) { return s >= 90 ? 'var(--green)' : s >= 75 ? 'var(--accent)' : s >= 60 ? 'var(--yellow)' : 'var(--orange)'; }
function bioColor(s) { return s >= 8 ? 'var(--green)' : s >= 6 ? 'var(--accent)' : s >= 4 ? 'var(--yellow)' : 'var(--red)'; }

function renderProducts() {
  const c = document.getElementById('productList');
  const products = [...getFiltered()].sort((a, b) =>
    (b.is_priority ? 1 : 0) - (a.is_priority ? 1 : 0) || (b.clean_score || 0) - (a.clean_score || 0)
  );
  if (!products.length) {
    c.innerHTML = '<div class="empty fade-in"><div class="empty-icon">üîç</div><div class="empty-title">≈Ωiadne produkty</div></div>';
    return;
  }

  c.innerHTML = products.map((p, i) => {
    const sc = p.clean_score || 0;
    const col = scoreColor(sc);
    const circ = 2 * Math.PI * 22;
    const off = circ - (sc / 100) * circ;
    const best = (p.offers || []).reduce((b, o) => (!b || o.sale_price < b.sale_price) ? o : b, null);
    const n = p.nutrition;
    const id = 'bio-' + i;

    let html = '<div class="product-card card-enter" style="animation-delay:' + (i * 0.04) + 's">';

    // Main row
    html += '<div class="product-main">';
    html += '<div class="score-ring"><svg width="52" height="52" viewBox="0 0 52 52"><circle class="track" cx="26" cy="26" r="22"/><circle class="fill" cx="26" cy="26" r="22" stroke="' + col + '" stroke-dasharray="' + circ + '" stroke-dashoffset="' + off + '"/></svg><div class="score-val" style="color:' + col + '">' + sc + '</div></div>';
    html += '<div class="product-info">';
    html += '<div class="product-name">' + (p.is_priority ? '‚≠ê ' : '') + p.name + '</div>';
    html += '<div class="product-meta">' + (CAT_LABELS[p.category]?.icon || '') + ' ' + (CAT_LABELS[p.category]?.label || p.category) + '</div>';

    if (best) {
      html += '<div class="price-row">';
      html += '<span class="price-sale">' + best.sale_price.toFixed(2).replace('.', ',') + ' Kƒç</span>';
      html += '<span class="price-unit">/ ' + (best.unit || 'ks') + '</span>';
      if (p.regular_price) html += '<span class="price-original">' + p.regular_price.toFixed(2).replace('.', ',') + ' Kƒç</span>';
      if (p.max_discount) html += '<span class="price-discount">-' + p.max_discount + '%</span>';
      html += '</div>';
    }

    html += '<div class="store-badges">';
    (p.offers || []).forEach(o => {
      html += '<div class="store-badge ' + (STORE_CLASS[o.store] || '') + '">' + o.store + ' <span class="badge-price">' + o.sale_price.toFixed(2).replace('.', ',') + ' Kƒç</span></div>';
    });
    html += '</div>';

    if (p.source_url) html += '<a class="source-link" href="' + p.source_url + '" target="_blank">üîó Overi≈• na Kupi.cz</a>';
    html += '</div></div>';

    // Nutrition bar
    if (n) {
      html += '<div class="nutrition-bar">';
      html += '<div class="nutri-item"><div class="nutri-val" style="color:var(--accent)">' + n.kcal + '</div><div class="nutri-label">kcal</div></div>';
      html += '<div class="nutri-item"><div class="nutri-val" style="color:var(--green)">' + n.protein + 'g</div><div class="nutri-label">Bielk.</div></div>';
      html += '<div class="nutri-item"><div class="nutri-val" style="color:var(--yellow)">' + n.carbs + 'g</div><div class="nutri-label">Sach.</div></div>';
      html += '<div class="nutri-item"><div class="nutri-val" style="color:var(--orange)">' + n.fat + 'g</div><div class="nutri-label">Tuky</div></div>';
      html += '<div class="nutri-item"><div class="nutri-val" style="color:var(--purple)">' + n.fiber + 'g</div><div class="nutri-label">Vl√°kn.</div></div>';
      html += '</div>';
      html += '<div class="nutri-per100">na 100g</div>';
    }

    // Bio audit toggle
    if (p.bio_audit) {
      html += '<div class="bio-toggle" onclick="toggleBio(\'' + id + '\',this)">üî¨ Biomedic√≠nsky audit <span class="arrow">‚ñº</span></div>';
      html += '<div class="bio-panel" id="' + id + '"><div class="bio-content">';
      Object.entries(p.bio_audit).forEach(([k, v]) => {
        html += '<div class="bio-item"><div class="bio-icon">' + (BIO_ICONS[k] || 'üìä') + '</div><div style="flex:1">';
        html += '<div class="bio-label">' + (BIO_LABELS[k] || k) + ' ‚Äî ' + v.score + '/10</div>';
        html += '<div class="bio-score-bar"><div class="bio-score-fill" style="width:' + (v.score * 10) + '%;background:' + bioColor(v.score) + '"></div></div>';
        html += '<div class="bio-detail">' + v.detail + '</div></div></div>';
      });
      html += '</div></div>';
    }

    html += '</div>';
    return html;
  }).join('');
}

function toggleBio(id, el) {
  const p = document.getElementById(id);
  const isOpen = p.classList.contains('open');
  document.querySelectorAll('.bio-panel.open').forEach(x => {
    x.classList.remove('open');
    x.previousElementSibling.classList.remove('open');
  });
  if (!isOpen) { p.classList.add('open'); el.classList.add('open'); }
}

// ===================== STORES VIEW =====================
function renderStores() {
  const c = document.getElementById('storeList');
  const products = appData?.products || [];
  const storeMap = {};

  products.forEach(p => {
    (p.offers || []).forEach(o => {
      if (!storeMap[o.store]) storeMap[o.store] = [];
      storeMap[o.store].push({
        name: p.name, category: p.category, is_priority: p.is_priority,
        clean_score: p.clean_score, max_discount: p.max_discount,
        sale_price: o.sale_price, unit: o.unit
      });
    });
  });

  const storeOrder = ['Lidl', 'Kaufland', 'Penny Market', 'Billa', 'Albert'];
  c.innerHTML = storeOrder.filter(s => storeMap[s]).map((store, si) => {
    const items = storeMap[store].sort((a, b) => a.sale_price - b.sale_price);
    return '<div class="store-group card-enter" style="animation-delay:' + (si * 0.08) + 's">' +
      '<div class="store-group-header">' +
        '<div class="store-group-icon" style="background:' + (STORE_COLORS[store] || '#666') + '22;color:' + (STORE_COLORS[store] || '#fff') + '">' + (STORE_ICONS[store] || 'üè™') + '</div>' +
        '<div><div class="store-group-name">' + store + '</div><div class="store-group-count">' + items.length + ' clean produktov v akcii</div></div>' +
      '</div>' +
      items.map(item =>
        '<div class="store-product">' +
          '<div><div class="sp-name">' + (item.is_priority ? '‚≠ê ' : '') + item.name + '</div>' +
          '<div class="sp-meta">' + (CAT_LABELS[item.category]?.icon || '') + ' ' + (item.unit || '') + ' ¬∑ Score ' + (item.clean_score || '-') + '</div></div>' +
          '<div><div class="sp-price">' + item.sale_price.toFixed(2).replace('.', ',') + ' Kƒç</div>' +
          (item.max_discount ? '<div class="sp-discount">-' + item.max_discount + '%</div>' : '') + '</div>' +
        '</div>'
      ).join('') +
    '</div>';
  }).join('');

  if (!c.innerHTML) {
    c.innerHTML = '<div class="empty"><div class="empty-icon">üè™</div><div class="empty-title">≈Ωiadne obchody</div></div>';
  }
}

// ===================== MEAL PLAN VIEW =====================
function renderMealPlan() {
  const c = document.getElementById('mealPlan');
  const products = appData?.products || [];
  const find = (substr) => products.find(p => p.name.toLowerCase().includes(substr.toLowerCase()));

  const meals = [
    {
      type: 'Ra≈àajky', icon: 'üåÖ', title: 'Tvarohov√° misa s ovoc√≠m',
      desc: 'R√Ωchle a prote√≠nov√© ra≈àajky pln√© probiot√≠k a vitam√≠nov.',
      ingredients: [
        { product: find('Tvaroh'), amount: '125g', note: '¬Ω balenia', grams: 125 },
        { product: find('Selsk√Ω jogurt') || find('jogurt'), amount: '100g', note: '', grams: 100 },
        { product: find('Ban√°n'), amount: '1 ks', note: 'nakr√°jan√Ω', grams: 120 },
        { product: find('kiwi'), amount: '1 ks', note: 'nakr√°jan√©', grams: 80 },
      ],
      steps: [
        'Tvaroh rozmixujte s jogurtom do kr√©movej konzistencie.',
        'Prelo≈æte do misky, navrch pridajte nakr√°jan√© ovocie.',
        'Voliteƒæne posypte orechmi alebo ovsen√Ωmi vloƒçkami.',
      ]
    },
    {
      type: 'Obed', icon: '‚òÄÔ∏è', title: 'Grilovan√© ku≈ôec√≠ prsa so zeleninou',
      desc: 'Vysokoproteinov√Ω obed s optim√°lnym mikro a makronutrientov√Ωm profilom.',
      ingredients: [
        { product: find('Ku≈ôec√≠ prsn√≠'), amount: '200g', note: '', grams: 200 },
        { product: find('Mrkev'), amount: '150g', note: 'nakr√°jan√°', grams: 150 },
        { product: find('okurk'), amount: '¬Ω ks', note: 'nakr√°jan√°', grams: 150 },
        { product: find('Olivov√Ω'), amount: '1 ly≈æica', note: '15ml', grams: 13 },
        { product: find('Pomeranƒç'), amount: '1 ks', note: '≈°≈•ava k dresinku', grams: 150 },
      ],
      steps: [
        'Ku≈ôec√≠ prsa ochucte soƒæou, koren√≠m a potrie≈•e olivov√Ωm olejom.',
        'Grilujte alebo opekajte na panvici 6‚Äì7 min z ka≈ædej strany.',
        'Zeleninu nakr√°jajte na ≈°al√°t, zalejte ≈°≈•avou z pomaranƒça.',
        'Pod√°vajte m√§so na zelenine, voliteƒæne s ry≈æou alebo chlebom.',
      ]
    },
    {
      type: 'Veƒçera', icon: 'üåô', title: 'Losos s mozzarellou a zeleninou',
      desc: 'Omega-3 bomba ide√°lna pre regener√°ciu a kardiovaskul√°rne zdravie.',
      ingredients: [
        { product: find('Losos'), amount: '150g', note: '1 filet', grams: 150 },
        { product: find('Mozzarella'), amount: '100g', note: '¬Ω balenia', grams: 100 },
        { product: find('okurk') || find('Mrkev'), amount: '100g', note: 'zelenina k losose', grams: 100 },
        { product: find('Olivov√Ω'), amount: '1 ly≈æica', note: '15ml', grams: 13 },
      ],
      steps: [
        'Lososa osolte a opekajte na panvici k≈Ø≈æ√≠ dol≈Ø 4 min, otoƒçte na 2 min.',
        'Na tanier rozlo≈æte mozzarellu so zeleninou.',
        'Pridajte lososa, pokvapkajte olivov√Ωm olejom.',
        'Voliteƒæne posypte ƒçerstvou bazalkou alebo rukolou.',
      ]
    },
    {
      type: 'Snack', icon: 'ü•ö', title: 'Vaj√≠ƒçka natvrdo s mrkvou',
      desc: 'Jednoduch√Ω snack bohat√Ω na chol√≠n a beta-karot√©n.',
      ingredients: [
        { product: find('ejce'), amount: '2 ks', note: 'natvrdo', grams: 120 },
        { product: find('Mrkev'), amount: '100g', note: 'tyƒçinky', grams: 100 },
      ],
      steps: [
        'Vaj√≠ƒçka varte 9 min√∫t vo vriacej vode.',
        'Ochlaƒète pod studenou vodou, ol√∫pte.',
        'Osolte, pod√°vajte s mrkvov√Ωmi tyƒçinkami.',
      ]
    },
  ];

  let dayKcal = 0, dayProt = 0, dayCarbs = 0, dayFat = 0, dayPrice = 0;

  const mealCards = meals.map((meal, mi) => {
    let mKcal = 0, mProt = 0, mCarbs = 0, mFat = 0, mPrice = 0;
    const validIngs = meal.ingredients.filter(ing => ing.product);

    validIngs.forEach(ing => {
      const p = ing.product;
      const price = p.best_price || (p.offers && p.offers[0] ? p.offers[0].sale_price : 0);
      // Estimate per-portion cost based on typical package size
      const estPrice = price * 0.25;
      mPrice += estPrice;
      if (p.nutrition) {
        const mult = (ing.grams || 100) / 100;
        mKcal += p.nutrition.kcal * mult;
        mProt += p.nutrition.protein * mult;
        mCarbs += p.nutrition.carbs * mult;
        mFat += p.nutrition.fat * mult;
      }
    });

    dayKcal += mKcal; dayProt += mProt; dayCarbs += mCarbs; dayFat += mFat; dayPrice += mPrice;

    let html = '<div class="meal-card card-enter" style="animation-delay:' + (mi * 0.08) + 's">';
    html += '<div class="meal-header"><div class="meal-type">' + meal.icon + ' ' + meal.type + '</div>';
    html += '<div class="meal-title">' + meal.title + '</div>';
    html += '<div class="meal-desc">' + meal.desc + '</div></div>';

    // Ingredients
    html += '<div class="meal-ingredients"><div class="meal-ing-title">Ingrediencie (z akciov√Ωch let√°kov)</div>';
    validIngs.forEach(ing => {
      const p = ing.product;
      const price = p.best_price || (p.offers && p.offers[0] ? p.offers[0].sale_price : 0);
      const estPrice = price * 0.25;
      html += '<div class="meal-ing-row"><span>' + ing.amount + ' ' + p.name + (ing.note ? ' (' + ing.note + ')' : '') + '</span>';
      html += '<span class="mi-price">~' + Math.round(estPrice) + ' Kƒç</span></div>';
    });
    html += '</div>';

    // Nutrition summary for this meal
    html += '<div class="nutrition-bar">';
    html += '<div class="nutri-item"><div class="nutri-val" style="color:var(--accent)">' + Math.round(mKcal) + '</div><div class="nutri-label">kcal</div></div>';
    html += '<div class="nutri-item"><div class="nutri-val" style="color:var(--green)">' + Math.round(mProt) + 'g</div><div class="nutri-label">Bielk.</div></div>';
    html += '<div class="nutri-item"><div class="nutri-val" style="color:var(--yellow)">' + Math.round(mCarbs) + 'g</div><div class="nutri-label">Sach.</div></div>';
    html += '<div class="nutri-item"><div class="nutri-val" style="color:var(--orange)">' + Math.round(mFat) + 'g</div><div class="nutri-label">Tuky</div></div>';
    html += '</div>';

    // Steps
    html += '<div class="meal-steps"><div class="meal-steps-title">Postup</div>';
    meal.steps.forEach((s, si) => {
      html += '<div class="meal-step"><b>' + (si + 1) + '.</b> ' + s + '</div>';
    });
    html += '</div>';

    // Total price
    html += '<div class="meal-total"><div class="meal-total-label">Odhadovan√° cena porcie</div>';
    html += '<div class="meal-total-price">~' + Math.round(mPrice) + ' Kƒç</div></div>';
    html += '</div>';
    return html;
  });

  // Day total
  let dayHtml = '<div class="day-total card-enter" style="animation-delay:0.4s">';
  dayHtml += '<div class="day-total-title">üìä Cel√Ω de≈à ‚Äî nutriƒçn√© hodnoty</div>';
  dayHtml += '<div class="day-total-grid">';
  dayHtml += '<div class="dt-item"><div class="dt-val" style="color:var(--accent)">' + Math.round(dayKcal) + '</div><div class="dt-label">kcal</div></div>';
  dayHtml += '<div class="dt-item"><div class="dt-val" style="color:var(--green)">' + Math.round(dayProt) + 'g</div><div class="dt-label">Bielkoviny</div></div>';
  dayHtml += '<div class="dt-item"><div class="dt-val" style="color:var(--yellow)">' + Math.round(dayCarbs) + 'g</div><div class="dt-label">Sacharidy</div></div>';
  dayHtml += '<div class="dt-item"><div class="dt-val" style="color:var(--orange)">' + Math.round(dayFat) + 'g</div><div class="dt-label">Tuky</div></div>';
  dayHtml += '</div>';
  dayHtml += '<div style="margin-top:12px;font-family:\'JetBrains Mono\',monospace;font-size:16px;color:var(--green)">Odhadovan√° cena d≈àa: ~' + Math.round(dayPrice) + ' Kƒç</div>';
  dayHtml += '</div>';

  c.innerHTML = mealCards.join('') + dayHtml;
}

// ===================== SERVICE WORKER =====================
if ('serviceWorker' in navigator) navigator.serviceWorker.register('./sw.js').catch(function(){});

// ===================== EMBEDDED DATA =====================
const EMBEDDED_DATA = {"flyer_week":"9.2-15.2.2026","generated_at":"2026-02-10T18:30:00Z","products":[{"name":"Ku≈ôec√≠ prsn√≠ ≈ô√≠zky","category":"meat","is_priority":true,"offers":[{"store":"Lidl","sale_price":109.90,"unit":"kg"},{"store":"Penny Market","sale_price":109.90,"unit":"kg"},{"store":"Kaufland","sale_price":129.90,"unit":"kg"}],"regular_price":219.90,"best_price":109.90,"max_discount":50,"clean_score":92,"source_url":"https://www.kupi.cz/sleva/kureci-prsni-rizky","nutrition":{"kcal":110,"protein":23.1,"carbs":0,"fat":1.2,"fiber":0},"bio_audit":{"microbiome":{"score":8,"detail":"ƒåist√© dr≈Øbe≈æ√≠ maso ‚Äî minim√°ln√≠ vliv na mikrobiom, bohat√© na tryptofan (prekurzor serotoninu)"},"cardiovascular":{"score":9,"detail":"N√≠zk√Ω obsah nasycen√Ωch tuk≈Ø, vysok√Ω pod√≠l b√≠lkovin podporuj√≠c√≠ch kardiovaskul√°rn√≠ zdrav√≠"},"metabolism":{"score":9,"detail":"Vysok√Ω termick√Ω efekt b√≠lkovin (TEF ~25%), podporuje svalovou synt√©zu a baz√°ln√≠ metabolismus"}}},{"name":"Ku≈ôe cel√©","category":"meat","is_priority":true,"offers":[{"store":"Lidl","sale_price":59.90,"unit":"kg"},{"store":"Penny Market","sale_price":62.90,"unit":"kg"}],"regular_price":109.90,"best_price":59.90,"max_discount":45,"clean_score":85,"source_url":"https://www.kupi.cz/sleva/kure-cele","nutrition":{"kcal":167,"protein":20.0,"carbs":0,"fat":9.3,"fiber":0},"bio_audit":{"microbiome":{"score":7,"detail":"Tmav√© maso obsahuje v√≠ce kolagenu a glycinu, prospƒõ≈°n√© pro st≈ôevn√≠ stƒõnu"},"cardiovascular":{"score":7,"detail":"Tmav√© maso m√° v√≠ce ≈æeleza a zinku, k≈Ø≈æe zvy≈°uje nasycen√© tuky ‚Äî doporuƒçuji k≈Ø≈æi odebrat"},"metabolism":{"score":8,"detail":"Kompletn√≠ aminokyselinov√Ω profil, B-vitam√≠ny (B3, B6) podporuj√≠ energetick√Ω metabolismus"}}},{"name":"Vep≈ôov√° plec bez kosti","category":"meat","is_priority":false,"offers":[{"store":"Kaufland","sale_price":99.90,"unit":"kg"}],"regular_price":159.90,"best_price":99.90,"max_discount":38,"clean_score":72,"source_url":"https://www.kupi.cz/sleva/veprova-plec","nutrition":{"kcal":186,"protein":18.5,"carbs":0,"fat":12.2,"fiber":0},"bio_audit":{"microbiome":{"score":6,"detail":"Vep≈ôov√© ‚Äî neutr√°ln√≠ vliv na mikrobiom, thiamin (B1) podporuje nervov√Ω syst√©m"},"cardiovascular":{"score":5,"detail":"Vy≈°≈°√≠ pod√≠l nasycen√Ωch tuk≈Ø ‚Äî preferovat libov√© ƒç√°sti, max 2√ó t√Ωdnƒõ"},"metabolism":{"score":7,"detail":"Dobr√Ω zdroj thiaminu (B1) a selenu, podporuje energetick√Ω metabolismus"}}},{"name":"Mlet√© maso mix 95%","category":"meat","is_priority":false,"offers":[{"store":"Billa","sale_price":79.90,"unit":"500g"}],"regular_price":129.90,"best_price":79.90,"max_discount":38,"clean_score":70,"source_url":"https://www.kupi.cz/sleva/mlete-maso","nutrition":{"kcal":145,"protein":20.0,"carbs":0,"fat":7.0,"fiber":0},"bio_audit":{"microbiome":{"score":6,"detail":"Mlet√© maso ‚Äî z√°le≈æ√≠ na kvalitƒõ, vyb√≠rejte s vysok√Ωm % masa bez p≈ô√≠davk≈Ø"},"cardiovascular":{"score":5,"detail":"Smƒõs hovƒõz√≠/vep≈ôov√© ‚Äî st≈ôedn√≠ obsah nasycen√Ωch tuk≈Ø, max 2√ó t√Ωdnƒõ"},"metabolism":{"score":7,"detail":"Dobr√Ω zdroj b√≠lkovin, ≈æeleza a B12, kompletn√≠ aminokyselinov√Ω profil"}}},{"name":"Losos filet s k≈Ø≈æ√≠","category":"fish","is_priority":true,"offers":[{"store":"Billa","sale_price":29.90,"unit":"100g"},{"store":"Lidl","sale_price":34.90,"unit":"100g"}],"regular_price":54.90,"best_price":29.90,"max_discount":46,"clean_score":96,"source_url":"https://www.kupi.cz/sleva/losos-filet","nutrition":{"kcal":208,"protein":20.4,"carbs":0,"fat":13.4,"fiber":0},"bio_audit":{"microbiome":{"score":9,"detail":"Omega-3 (EPA/DHA) maj√≠ protiz√°nƒõtliv√Ω √∫ƒçinek na st≈ôevn√≠ mikrobiom a podporuj√≠ integritu bari√©ry"},"cardiovascular":{"score":10,"detail":"Omega-3 sni≈æuj√≠ triglyceridy, krevn√≠ tlak a riziko arytmi√≠ ‚Äî kardiologov√© doporuƒçuj√≠ 2√ó t√Ωdnƒõ"},"metabolism":{"score":9,"detail":"Vitam√≠n D, selen, astaxanthin ‚Äî omega-3 zlep≈°uj√≠ inzul√≠novou citlivost"}}},{"name":"Franz Josef Tu≈à√°k steak 170/120g","category":"fish","is_priority":false,"offers":[{"store":"Kaufland","sale_price":34.90,"unit":"ks"},{"store":"Penny Market","sale_price":36.90,"unit":"ks"}],"regular_price":54.90,"best_price":34.90,"max_discount":36,"clean_score":85,"source_url":"https://www.kupi.cz/sleva/tunak-steak","nutrition":{"kcal":116,"protein":25.5,"carbs":0,"fat":1.0,"fiber":0},"bio_audit":{"microbiome":{"score":7,"detail":"Konzervovan√Ω tu≈à√°k ‚Äî minim√°ln√≠ zpracov√°n√≠, pozor na obsah sod√≠ku"},"cardiovascular":{"score":8,"detail":"Bohat√Ω na omega-3 a b√≠lkoviny, niacin sni≈æuje LDL cholesterol"},"metabolism":{"score":8,"detail":"Niacin (B3) a selen podporuj√≠ metabolismus, kompletn√≠ aminokyseliny"}}},{"name":"Alja≈°sk√° treska Kimbex mra≈æen√°","category":"fish","is_priority":false,"offers":[{"store":"Lidl","sale_price":69.90,"unit":"400g"}],"regular_price":99.90,"best_price":69.90,"max_discount":30,"clean_score":90,"source_url":"https://www.kupi.cz/sleva/treska-aljaska","nutrition":{"kcal":82,"protein":17.6,"carbs":0,"fat":0.7,"fiber":0},"bio_audit":{"microbiome":{"score":8,"detail":"ƒåist√© ryb√≠ fil√© ‚Äî neutr√°ln√≠ a≈æ pozitivn√≠ vliv na mikrobiom, lehce straviteln√©"},"cardiovascular":{"score":8,"detail":"N√≠zkotuƒçn√° ryba s vysok√Ωm pod√≠lem b√≠lkovin, vhodn√° pro sni≈æov√°n√≠ cholesterolu"},"metabolism":{"score":8,"detail":"J√≥d podporuje ≈°t√≠tnou ≈æl√°zu, fosfor je kl√≠ƒçov√Ω pro energetick√Ω metabolismus"}}},{"name":"Tvaroh tuƒçn√Ω Karlova Koruna 250g","category":"dairy","is_priority":true,"offers":[{"store":"Penny Market","sale_price":12.90,"unit":"ks"},{"store":"Kaufland","sale_price":14.90,"unit":"ks"}],"regular_price":24.90,"best_price":12.90,"max_discount":48,"clean_score":94,"source_url":"https://www.kupi.cz/sleva/tvaroh-karlova-koruna","nutrition":{"kcal":155,"protein":12.5,"carbs":3.0,"fat":10.5,"fiber":0},"bio_audit":{"microbiome":{"score":9,"detail":"Tvaroh obsahuje p≈ôirozen√© probiotick√© kultury, kasein ≈æiv√≠ prospƒõ≈°n√© bakterie v tlust√©m st≈ôevƒõ"},"cardiovascular":{"score":7,"detail":"Bohat√Ω na v√°pn√≠k a fosfor, tuƒçn√° varianta m√° vy≈°≈°√≠ nasycen√© tuky"},"metabolism":{"score":9,"detail":"Kasein = pomal√© uvol≈àov√°n√≠ aminokyselin, ide√°ln√≠ pro regeneraci a noƒçn√≠ metabolismus"}}},{"name":"Mozzarella Pilos 195g","category":"dairy","is_priority":false,"offers":[{"store":"Lidl","sale_price":12.90,"unit":"ks"}],"regular_price":24.90,"best_price":12.90,"max_discount":48,"clean_score":88,"source_url":"https://www.kupi.cz/sleva/mozzarella-pilos","nutrition":{"kcal":254,"protein":18.5,"carbs":1.0,"fat":19.5,"fiber":0},"bio_audit":{"microbiome":{"score":7,"detail":"Fermentovan√Ω s√Ωr s n√≠zkou lakt√≥zou, ≈°etrn√Ω k mikrobiomu"},"cardiovascular":{"score":7,"detail":"St≈ôedn√≠ obsah tuk≈Ø, bohat√Ω na v√°pn√≠k ‚Äî prospƒõ≈°n√Ω pro krevn√≠ tlak"},"metabolism":{"score":7,"detail":"Kompletn√≠ b√≠lkoviny, v√°pn√≠k podporuje lipol√Ωzu (spalov√°n√≠ tuk≈Ø)"}}},{"name":"Smetanov√Ω jogurt Zlat√Ω Florian Olma 150g","category":"dairy","is_priority":false,"offers":[{"store":"Billa","sale_price":9.90,"unit":"ks"}],"regular_price":17.90,"best_price":9.90,"max_discount":45,"clean_score":78,"source_url":"https://www.kupi.cz/sleva/jogurt-zlaty-florian","nutrition":{"kcal":118,"protein":3.8,"carbs":12.5,"fat":5.8,"fiber":0},"bio_audit":{"microbiome":{"score":8,"detail":"Jogurt se ≈æiv√Ωmi kulturami ‚Äî p≈ô√≠m√° podpora mikrobiotick√© diverzity"},"cardiovascular":{"score":6,"detail":"Smetanov√Ω jogurt m√° vy≈°≈°√≠ obsah tuk≈Ø, preferovat b√≠lou variantu"},"metabolism":{"score":7,"detail":"Probiotika zlep≈°uj√≠ absorpci ≈æivin, v√°pn√≠k podporuje metabolismus"}}},{"name":"Selsk√Ω jogurt Hollandia 380g (zraje v kel√≠mku)","category":"dairy","is_priority":true,"offers":[{"store":"Kaufland","sale_price":19.90,"unit":"ks"},{"store":"Albert","sale_price":22.90,"unit":"ks"}],"regular_price":34.90,"best_price":19.90,"max_discount":43,"clean_score":92,"source_url":"https://www.kupi.cz/sleva/selsky-jogurt-hollandia","nutrition":{"kcal":72,"protein":3.5,"carbs":4.8,"fat":3.8,"fiber":0},"bio_audit":{"microbiome":{"score":9,"detail":"Zraje v kel√≠mku ‚Äî ≈æiv√© kultury L. bulgaricus a S. thermophilus p≈ôe≈æ√≠vaj√≠ do konzumace"},"cardiovascular":{"score":7,"detail":"Fermentace zlep≈°uje profil mastn√Ωch kyselin, v√°pn√≠k podporuje krevn√≠ tlak"},"metabolism":{"score":8,"detail":"Probiotika zlep≈°uj√≠ absorpci ≈æivin a inzul√≠novou citlivost"}}},{"name":"Hollandia kr√©mov√Ω jogurt 150g","category":"dairy","is_priority":false,"offers":[{"store":"Penny Market","sale_price":8.90,"unit":"ks"}],"regular_price":14.90,"best_price":8.90,"max_discount":40,"clean_score":80,"source_url":"https://www.kupi.cz/sleva/hollandia-kremovy","nutrition":{"kcal":95,"protein":3.2,"carbs":13.0,"fat":3.2,"fiber":0},"bio_audit":{"microbiome":{"score":8,"detail":"Kvalitn√≠ jogurt s ≈æiv√Ωmi kulturami, kr√©mov√° textura naznaƒçuje vy≈°≈°√≠ obsah tuku"},"cardiovascular":{"score":6,"detail":"St≈ôedn√≠ obsah tuk≈Ø, v√°pn√≠k a drasl√≠k pozitivnƒõ ovliv≈àuj√≠ krevn√≠ tlak"},"metabolism":{"score":7,"detail":"Probiotika a b√≠lkoviny podporuj√≠ zdrav√Ω metabolismus, pozor na p≈ôidan√© cukry"}}},{"name":"ƒåerstv√° podest√Ωlkov√° vejce M 30ks","category":"dairy","is_priority":true,"offers":[{"store":"Kaufland","sale_price":149.90,"unit":"30ks"}],"regular_price":189.90,"best_price":149.90,"max_discount":21,"clean_score":98,"source_url":"https://www.kupi.cz/sleva/vejce-m-30ks","nutrition":{"kcal":143,"protein":12.6,"carbs":0.7,"fat":9.9,"fiber":0},"bio_audit":{"microbiome":{"score":8,"detail":"Lecitin podporuje integritu st≈ôevn√≠ bari√©ry, ≈æloutek obsahuje fosfolipidy"},"cardiovascular":{"score":8,"detail":"Nov√° evidence: diet√°rn√≠ cholesterol z vajec m√° minim√°ln√≠ vliv na krevn√≠ cholesterol"},"metabolism":{"score":10,"detail":"Cholin (essential nutrient), kompletn√≠ b√≠lkovina, vitam√≠n D, B12, selen ‚Äî metabolick√Ω superfood"}}},{"name":"Vejce S podest√Ωlkov√° 30ks","category":"dairy","is_priority":false,"offers":[{"store":"Penny Market","sale_price":99.90,"unit":"30ks"}],"regular_price":139.90,"best_price":99.90,"max_discount":29,"clean_score":98,"source_url":"https://www.kupi.cz/sleva/vejce-s-30ks","nutrition":{"kcal":143,"protein":12.6,"carbs":0.7,"fat":9.9,"fiber":0},"bio_audit":{"microbiome":{"score":8,"detail":"Lecitin podporuje integritu st≈ôevn√≠ bari√©ry, ≈æloutek obsahuje fosfolipidy"},"cardiovascular":{"score":8,"detail":"Nov√° evidence: diet√°rn√≠ cholesterol z vajec m√° minim√°ln√≠ vliv na krevn√≠ cholesterol"},"metabolism":{"score":10,"detail":"Cholin (essential nutrient), kompletn√≠ b√≠lkovina, vitam√≠n D, B12, selen ‚Äî metabolick√Ω superfood"}}},{"name":"Pomeranƒçe","category":"produce","is_priority":true,"offers":[{"store":"Penny Market","sale_price":19.90,"unit":"kg"},{"store":"Lidl","sale_price":32.90,"unit":"kg"}],"regular_price":39.90,"best_price":19.90,"max_discount":50,"clean_score":100,"source_url":"https://www.kupi.cz/sleva/pomerance","nutrition":{"kcal":47,"protein":0.9,"carbs":11.8,"fat":0.1,"fiber":2.4},"bio_audit":{"microbiome":{"score":9,"detail":"Pektin ‚Äî rozpustn√° vl√°knina ≈æiv√≠c√≠ Bifidobacterium v tlust√©m st≈ôevƒõ"},"cardiovascular":{"score":9,"detail":"Vitam√≠n C, hesperidin, naringenin ‚Äî flavonoidy sni≈æuj√≠c√≠ tlak a z√°nƒõt c√©v"},"metabolism":{"score":8,"detail":"Vitam√≠n C zvy≈°uje absorpci ≈æeleza, fol√°t podporuje bunƒõƒçn√Ω metabolismus"}}},{"name":"Ban√°ny","category":"produce","is_priority":false,"offers":[{"store":"Lidl","sale_price":22.90,"unit":"kg"},{"store":"Kaufland","sale_price":24.90,"unit":"kg"}],"regular_price":34.90,"best_price":22.90,"max_discount":34,"clean_score":100,"source_url":"https://www.kupi.cz/sleva/banany","nutrition":{"kcal":89,"protein":1.1,"carbs":22.8,"fat":0.3,"fiber":2.6},"bio_audit":{"microbiome":{"score":9,"detail":"Rezistentn√≠ ≈°krob (nezral√© ban√°ny) je prebiotikum pro prospƒõ≈°n√© st≈ôevn√≠ bakterie"},"cardiovascular":{"score":8,"detail":"Drasl√≠k (358mg/100g) reguluje krevn√≠ tlak, B6 sni≈æuje homocystein"},"metabolism":{"score":7,"detail":"Rychl√Ω zdroj energie (GI 51), vhodn√Ω post-workout, B6 podporuje metabolismus b√≠lkovin"}}},{"name":"Hrozny tmav√©/r≈Ø≈æov√© bezsemenn√© 500g","category":"produce","is_priority":false,"offers":[{"store":"Lidl","sale_price":44.90,"unit":"500g"},{"store":"Billa","sale_price":49.90,"unit":"500g"}],"regular_price":69.90,"best_price":44.90,"max_discount":36,"clean_score":95,"source_url":"https://www.kupi.cz/sleva/hrozny-bezsemenne","nutrition":{"kcal":69,"protein":0.7,"carbs":18.1,"fat":0.2,"fiber":0.9},"bio_audit":{"microbiome":{"score":8,"detail":"Polyfenoly v hroznech (resveratrol) podporuj√≠ mikrobiotickou diverzitu"},"cardiovascular":{"score":9,"detail":"Resveratrol a flavonoidy chr√°n√≠ c√©vn√≠ stƒõny, sni≈æuj√≠ oxidaci LDL"},"metabolism":{"score":7,"detail":"P≈ô√≠rodn√≠ cukry s polyfenoly ‚Äî lep≈°√≠ ne≈æ rafinovan√©, ale vy≈°≈°√≠ GI"}}},{"name":"Mrkev","category":"produce","is_priority":false,"offers":[{"store":"Penny Market","sale_price":9.90,"unit":"kg"},{"store":"Kaufland","sale_price":12.90,"unit":"kg"}],"regular_price":24.90,"best_price":9.90,"max_discount":60,"clean_score":100,"source_url":"https://www.kupi.cz/sleva/mrkev","nutrition":{"kcal":41,"protein":0.9,"carbs":9.6,"fat":0.2,"fiber":2.8},"bio_audit":{"microbiome":{"score":8,"detail":"Bohat√© na vl√°kninu a beta-karoten, podporuj√≠ diverzitu st≈ôevn√≠ho mikrobiomu"},"cardiovascular":{"score":8,"detail":"Beta-karoten a luteolin ‚Äî antioxidaƒçn√≠ √∫ƒçinky na c√©vy, drasl√≠k reguluje tlak"},"metabolism":{"score":8,"detail":"N√≠zkokalorick√©, beta-karoten se p≈ôemƒõ≈àuje na vitam√≠n A, podpora imunity"}}},{"name":"Sal√°tov√° okurka","category":"produce","is_priority":false,"offers":[{"store":"Penny Market","sale_price":14.90,"unit":"ks"},{"store":"Lidl","sale_price":16.90,"unit":"ks"}],"regular_price":24.90,"best_price":14.90,"max_discount":40,"clean_score":100,"source_url":"https://www.kupi.cz/sleva/salatova-okurka","nutrition":{"kcal":15,"protein":0.7,"carbs":3.6,"fat":0.1,"fiber":0.5},"bio_audit":{"microbiome":{"score":7,"detail":"Vysok√Ω obsah vody a vl√°kniny, podporuje pravideln√© tr√°ven√≠"},"cardiovascular":{"score":7,"detail":"Drasl√≠k a ho≈ôƒç√≠k reguluj√≠ krevn√≠ tlak, t√©mƒõ≈ô nulov√Ω obsah sod√≠ku"},"metabolism":{"score":7,"detail":"Ultra-n√≠zkokalorick√° (15kcal/100g), hydratuje, vhodn√° p≈ôi redukƒçn√≠ dietƒõ"}}},{"name":"Extra sladk√© zlat√© kiwi","category":"produce","is_priority":false,"offers":[{"store":"Lidl","sale_price":49.90,"unit":"4ks"}],"regular_price":69.90,"best_price":49.90,"max_discount":29,"clean_score":100,"source_url":"https://www.kupi.cz/sleva/zlate-kiwi","nutrition":{"kcal":63,"protein":1.1,"carbs":15.4,"fat":0.3,"fiber":2.0},"bio_audit":{"microbiome":{"score":8,"detail":"Kiwi obsahuje actinidin (enzym) usnad≈àuj√≠c√≠ tr√°ven√≠ b√≠lkovin, prebiotick√© √∫ƒçinky"},"cardiovascular":{"score":8,"detail":"Vitam√≠n C (161mg/100g u zlat√©ho kiwi) chr√°n√≠ c√©vy, sni≈æuje krevn√≠ tlak"},"metabolism":{"score":8,"detail":"Jeden z nejvy≈°≈°√≠ch zdroj≈Ø vitam√≠nu C, fol√°t a vitam√≠n K podpora metabolismu"}}},{"name":"Borges Olivov√Ω olej extra mild 500ml","category":"pantry","is_priority":true,"offers":[{"store":"Kaufland","sale_price":99.90,"unit":"500ml"}],"regular_price":179.90,"best_price":99.90,"max_discount":44,"clean_score":95,"source_url":"https://www.kupi.cz/sleva/olivovy-olej-borges","nutrition":{"kcal":884,"protein":0,"carbs":0,"fat":100.0,"fiber":0},"bio_audit":{"microbiome":{"score":8,"detail":"Polyfenoly (oleocanthal, oleuropein) podporuj√≠ r≈Øst prospƒõ≈°n√Ωch bakteri√≠"},"cardiovascular":{"score":10,"detail":"Kyselina olejov√° (73%) ‚Äî z√°klad st≈ôedomo≈ôsk√© diety, sni≈æuje LDL a z√°nƒõt c√©v"},"metabolism":{"score":8,"detail":"Mononenasycen√© tuky zlep≈°uj√≠ inzul√≠novou citlivost a metabolismus tuk≈Ø"}}}]};

// ===================== INIT =====================
loadData();
</script>
</body>
</html>
